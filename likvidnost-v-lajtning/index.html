<!doctype html><html lang=ru dir=ltr><head><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&display=swap" rel=stylesheet><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Джейсон Лопп: уроки, полученные при управлении узлом маршрутизации в сети Lightning."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta name=lightning content="21ideas@getalby.com"><meta property="og:title" content="Руководство по управлению ликвидностью в сети Lightning"><meta property="og:description" content="Джейсон Лопп: уроки, полученные при управлении узлом маршрутизации в сети Lightning."><meta property="og:type" content="article"><meta property="og:url" content="https://21ideas.org/likvidnost-v-lajtning/"><meta property="og:image" content="https://21ideas.org/img/lln-263.jpg"><title>Руководство по управлению ликвидностью в сети Lightning | 21ideas</title>
<link rel=manifest href=/manifest.json><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon media="(prefers-color-scheme: dark)" sizes=180x180 href=/apple-touch-icon-dark.png><link rel=icon type=image/png media="(prefers-color-scheme: dark)" sizes=32x32 href=/favicon-32x32-dark.png><link rel=icon type=image/png media="(prefers-color-scheme: dark)" sizes=16x16 href=/favicon-16x16-dark.png><link rel=alternate hreflang=en href=https://21ideas.org/en/lightning-liquidity-management-guide/ title="Lightning Liquidity Management Guide"><link rel=stylesheet href=/book.min.a88fda41628a86b0aa4a3caa9c8ab466ee8e01a433898186e506a93fb98f1884.css integrity="sha256-qI/aQWKKhrCqSjyqnIq0Zu6OAaQziYGG5QapP7mPGIQ=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script><script defer src=/ru.search.min.0312e880b1bac4b36cc0a7d3d7649c535ec5e00d0ba02433beaec7125e7255a0.js integrity="sha256-AxLogLG6xLNswKfT12ScU17F4A0LoCQzvq7HEl5yVaA=" crossorigin=anonymous></script><script type=text/javascript src=https://unpkg.com/zapthreads@0.5.2/dist/zapthreads.iife.js></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><picture><source srcset=/svg/logo_white.svg media="(prefers-color-scheme: dark)"><img src=/svg/logo_black.svg alt=Logo>
</picture><span>21ideas</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Поиск aria-label=Поиск maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul class=book-languages><li><input type=checkbox id=languages class=toggle>
<label for=languages class="flex justify-between"><a role=button class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
Русский</a></label><ul><li><a href=https://21ideas.org/en/lightning-liquidity-management-guide/>English</a></li></ul></li></ul><ul><li><input type=checkbox id=section-b0dafb98a5d0578d631a1c9dd29bee81 class=toggle>
<label for=section-b0dafb98a5d0578d631a1c9dd29bee81 class="flex justify-between"><a href=/start/>Старт</a></label><ul><li><a href=/glossary/>Глоссарий</a></li><li><a href=/start/start/>Что такое Биткоин?</a></li><li><a href=/start/guide/>Используем биткоин</a></li><li><a href=/course/>Биткоин от А до Я</a></li><li><a href=/bitcoin-myths/>Разрушаем мифы о Биткоине</a></li><li><a href=/shitcoin-casino/>Не играйте в щиткоин-казино</a></li></ul></li><li><input type=checkbox id=section-f4a619252679302c899a690180d7ffa2 class=toggle>
<label for=section-f4a619252679302c899a690180d7ffa2 class="flex justify-between"><a href=/theory/>Теория</a></label><ul><li><input type=checkbox id=section-356070beafdf88b67731f5d7a38cd521 class=toggle>
<label for=section-356070beafdf88b67731f5d7a38cd521 class="flex justify-between"><a href=/economics/>Экономика</a></label><ul><li><input type=checkbox id=section-9c21df0254e6f531458131e593d77332 class=toggle>
<label for=section-9c21df0254e6f531458131e593d77332 class="flex justify-between"><a href=/pzv/>Постепенно, затем внезапно</a></label><ul><li><a href=/pzv/postepenno-zatem-vnezapno/>Введение</a></li><li><a href=/pzv/bitkoin-nelzya-skopirovat/>Биткоин нельзя скопировать</a></li><li><a href=/pzv/bitkoin-ne-slishkom-volatilen/>Биткоин не слишком волатилен</a></li><li><a href=/pzv/bitkoin-ne-tratit-energiyu-zrya/>Биткоин не тратит энергию зря</a></li><li><a href=/pzv/bitkoin-ne-slishkom-medlennyj/>Биткоин не слишком медленный</a></li><li><a href=/pzv/bitkoin-eto-ispravit/>Биткоин это исправит</a></li><li><a href=/pzv/bitkoin-ne-blokchejn/>Биткоин, не блокчейн</a></li><li><a href=/pzv/bitkoin-nichem-ne-podkreplen/>Биткоин ничем не подкреплен?</a></li><li><a href=/pzv/bitkoin-ne-finansovaya-piramida/>Биткоин — не финансовая пирамида</a></li><li><a href=/pzv/bitkoin-ne-mozhet-byt-zabanen/>Биткоин не может быть забанен</a></li><li><a href=/pzv/bitkoin-ne-dlya-prestupnikov/>Биткоин не для преступников</a></li><li><a href=/pzv/bitkoin-obescenivaet-ostalnye-dengi/>Биткоин обесценивает остальные деньги</a></li><li><a href=/pzv/bitkoin-zov-k-edineniyu/>Биткоин — зов к единению</a></li><li><a href=/pzv/bitkoin-eto-zdravyj-smysl/>Биткоин — это здравый смысл</a></li><li><a href=/pzv/bitkoin-antihrupok/>Биткоин антихрупок</a></li><li><a href=/pzv/bitkoin-velikaya-definancializaciya/>Биткоин — великая дефинанcиализация</a></li></ul></li><li><input type=checkbox id=section-f75619703a6dc5d9286c6f2682febebb class=toggle>
<label for=section-f75619703a6dc5d9286c6f2682febebb class="flex justify-between"><a href=/sb/>Становление Биткоина</a></label><ul><li><a href=/sb/stanovlenie-intro/>Введение</a></li><li><a href=/sb/stanovlenie-1/>О времени</a></li><li><a href=/sb/stanovlenie-2/>О людях</a></li><li><a href=/sb/stanovlenie-3/>Знакомьтесь: деньги</a></li><li><a href=/sb/stanovlenie-4/>Поворот не туда</a></li><li><a href=/sb/stanovlenie-5/>Цифровая редкость</a></li><li><a href=/sb/stanovlenie-6/>Цифровые контракты</a></li><li><a href=/sb/stanovlenie-7/>Недостающие части головоломки</a></li></ul></li><li><a href=/bitkoin-ne-vredit-okruzhayushej-srede/>Биткоин и окружающая среда</a></li><li><a href=/sem-setevyh-effektov-bitkoina/>Семь сетевых эффектов Биткоина</a></li><li><a href=/hozyaeva-i-raby-deneg/>Хозяева и рабы денег</a></li><li><a href=/strukturnaya-perestrojka/>Структурная перестройка</a></li><li><a href=/v-zashchitu-deflyacii/>В защиту дефляции</a></li><li><a href=/sravnenie-monetarnyh-standartov/>Сравнение монетарных стандартов</a></li><li><a href=/negativnye-effekty-neftedollara/>Негативные внешние эффекты нефтедоллара</a></li><li><a href=/raskoshelivaemsya/>Раскошеливаемся (Shelling Out): Происхождение денег</a></li><li><a href=/bitcoin-i-ritmy-istorii/>Биткоин и ритмы истории</a></li><li><a href=/bitcoin-i-internet-cikly-hopfa/>Биткоин и интернет-циклы Хопфа</a></li><li><a href=/dengi-blokchejny-i-socialnaya-masshtabiruemost/>Деньги, блокчейны и социальная масштабируемость</a></li><li><a href=/chto-takoe-dengi/>Что такое деньги</a></li><li><a href=/vyzhivaet-silnejshij/>Выживает сильнейший</a></li><li><a href=/strategiya-dca/>Стратегия DCA</a></li><li><a href=/jevons-paradox/>Парадокс Джевонса: Обратная истина</a></li><li><a href=/kak-rabotajut-dengi/>Как работают деньги</a></li></ul></li><li><input type=checkbox id=section-25dd0684538231cc6c8c9cfa92ec4aa8 class=toggle>
<label for=section-25dd0684538231cc6c8c9cfa92ec4aa8 class="flex justify-between"><a href=/security/>Безопасность</a></label><ul><li><a href=/kak-hranit-kljuchi/>Биткоин-кошельки. Зачем и как хранить свои приватные ключи</a></li><li><a href=/seed/>Что такое сид-фраза?</a></li><li><a href=/seed-security/>Как обезопасить свои сид-фразы?</a></li><li><a href=/passphrase/>Насколько надежна ваша парольная фраза?</a></li><li><a href=/multisig/>Все о мультисиг</a></li><li><a href=/hwws/>Сравнение аппаратных кошельков</a></li><li><a href=/multisig-1/>Мультисиг. Часть I</a></li><li><a href=/multisig-2/>Мультисиг. Часть II: Отдельные ключи – основа мультиподписи</a></li></ul></li><li><input type=checkbox id=section-aff498226e3572dbd162673efd80256d class=toggle>
<label for=section-aff498226e3572dbd162673efd80256d class="flex justify-between"><a href=/privacy/>Приватность</a></label><ul><li><a href=/privacy/luchshie-praktiki/>Как сохранить приватность?</a></li><li><a href=/privacy/no-kyc/>Никаких KYC, берегите персональные данные</a></li><li><a href=/privatnost-v-seti-bitcoin/>Приватность в сети Биткоин</a></li><li><a href=/bitcoin-stanovitsya-kriticheski-vazhnym/>Биткоин становится критически важным</a></li><li><a href=/bip47-ili-gadkij-utenok/>BIP47, или гадкий утенок</a></li><li><input type=checkbox id=section-e925ecbcdc92e383b7ea825222e52704 class=toggle>
<label for=section-e925ecbcdc92e383b7ea825222e52704 class="flex justify-between"><a href=/privacy/oxt/>Понимание приватности в сети Биткоин с помощью OXT</a></label><ul><li><a href=/privacy/oxt-1/>Часть 1: Анализ цепочки и приватность транзакций</a></li><li><a href=/privacy/oxt-2/>Часть 2: Ключевые концепции анализа цепочки</a></li><li><a href=/privacy/oxt-3/>Часть 3: Защита от анализа цепочки</a></li><li><a href=/privacy/oxt-4/>Часть 4: Применение концепций анализа цепочки для улучшения приватности пользователей</a></li></ul></li><li><a href=/privacy/coinjoin/>Понимание и использование CoinJoin</a></li><li><a href=/bitcoin-fungibility/>Взаимозаменяемость Биткоина</a></li><li><a href=/freesamourai/>#FreeSamourai</a></li></ul></li><li><input type=checkbox id=section-0c147b062aca36b71690569b35776e24 class=toggle>
<label for=section-0c147b062aca36b71690569b35776e24 class="flex justify-between"><a href=/protocol/>Протокол</a></label><ul><li><a href=/kto-kontroliruet-bitkoin-kor/>Кто контролирует Bitcoin Core?</a></li><li><a href=/vechnaja-borba/>Вечная борьба Биткоина</a></li><li><a href=/ob-udobstve-vzaimodejstvija-s-bitcoinom/>Об удобстве взаимодействия с Биткоином</a></li><li><a href=/bitcoin-zoloto-2-0/>Биткоин: цифровое золото или пиринговая наличность?</a></li><li><a href=/upravlenie-bitcoin/>Управление Биткоином</a></li><li><a href=/doverennye-tretyi-storony/>Доверенные третьи стороны — это бреши в системе безопасности</a></li><li><a href=/21-million-ne-podlezhit-obsuzhdeniyu/>21 миллион не подлежит обсуждению</a></li><li><a href=/proof-of-work/>Proof of Work: доказательство проделанной работы</a></li><li><a href=/proof-of-stake-eto-skam/>Proof of Stake – это скам</a></li><li><a href=/byl-li-satoshi-zhadnym-majnerom/>Был ли Сатоши жадным майнером?</a></li><li><a href=/segwit/>Что такое SegWit</a></li><li><a href=/taproot/>Что такое Taproot</a></li><li><a href=/bomby-slozhnosti-ethereum/>Бомбы сложности Ethereum</a></li><li><a href=/rgb/>Разбирая протокол RGB</a></li><li><a href=/halving/>Что такое Биткоин-халвинг?</a></li><li><a href=/difficulty/>О корректировке сложности майнинга</a></li><li><a href=/sravnenie-tipov-bitcoin-adresov/>Типы биткоин-адресов</a></li><li><a href=/myths-about-halving/>Мифы о Биткоин-халвинге</a></li><li><a href=/mining-walkthrough/>SHA256 и майнинг в сети Биткоин</a></li><li><input type=checkbox id=section-b92a36e5ae31c3fd403b01b9c2ec1c8b class=toggle>
<label for=section-b92a36e5ae31c3fd403b01b9c2ec1c8b class="flex justify-between"><a href=/protocol/utxo/>Что такое UTXO и как ими управлять?</a></label><ul><li><a href=/protocol/utxo-1/>Что такое UTXO?</a></li><li><a href=/protocol/utxo-2/>Как избежать высоких комиссий при большом количестве UTXO</a></li><li><a href=/protocol/utxo-3/>Приватность UTXO</a></li></ul></li><li><a href=/timestamps/>Временны́е метки в Биткоине</a></li><li><a href=/transaction-size/>Размер транзакции</a></li><li><a href=/o-zakostenenii-protokola/>О закостенении протокола</a></li></ul></li><li><input type=checkbox id=section-06b1b370d2d0779d84f03a0910de7588 class=toggle>
<label for=section-06b1b370d2d0779d84f03a0910de7588 class="flex justify-between"><a href=/history/>История</a></label><ul><li><input type=checkbox id=section-139f117b6284888a0eef6a640eb6c1bd class=toggle>
<label for=section-139f117b6284888a0eef6a640eb6c1bd class="flex justify-between"><a href=/gf/>Генезис-файлы</a></label><ul><li><a href=/gf/genesis-intro/>Пролог</a></li><li><a href=/gf/genesis-1/>Часть I: eCash Дэвида Чаума и зарождение мечты шифропанков</a></li><li><a href=/gf/genesis-2/>Часть II: Hashcash или как Адам Бэк разработал сердце Биткоина</a></li><li><a href=/gf/genesis-3/>Часть III: Если у Биткоина был прототип, то это были b-money Вэя Дая</a></li><li><a href=/gf/genesis-4/>Часть IV: Создавая Bit Gold, Сабо был в двух шагах от изобретения Биткоина</a></li><li><a href=/gf/genesis-5/>Часть V: Как поиски цифровой наличности привели Хэла Финни к созданию RPOW (и не только)</a></li></ul></li><li><a href=/hal-finney/>Хэл Финни — жизнь и смерть легенды движения шифропанков</a></li><li><a href=/bitcoin-and-me/>Биткоин и я</a></li><li><a href=/bitcoin-reformaciya/>Биткоин-Реформация</a></li><li><a href=/bitcoin-forks/>Полная история консенсус-форков Биткоина</a></li><li><a href=/analyzing-2013-fork/>Анализ форка Биткоина 2013 года</a></li><li><input type=checkbox id=section-75b9ecb484c68d9cfe79cb170ea1cece class=toggle>
<label for=section-75b9ecb484c68d9cfe79cb170ea1cece class="flex justify-between"><a href=/sr/>Silk Road</a></label><ul><li><a href=/sr/silkroad-1/>Скаут, Биткоин и грибы</a></li><li><a href=/sr/silkroad-2/>Первые успехи и неудачи нарко-Amazon'a</a></li><li><a href=/sr/silkroad-3/>Ужасный Пират Робертс</a></li><li><a href=/sr/silkroad-4/>Компания, заработавшая тысячи биткоинов</a></li><li><a href=/sr/silkroad-5/>Тёмная сторона Silk Road</a></li><li><a href=/sr/silkroad-6/>Розыск и арест Росса Ульбрихта</a></li></ul></li></ul></li><li><input type=checkbox id=section-af85ae42a802ac9fce098ca6b8d6a65b class=toggle>
<label for=section-af85ae42a802ac9fce098ca6b8d6a65b class="flex justify-between"><a href=/philosophy/>Философия</a></label><ul><li><input type=checkbox id=section-d0147c75204bce6530fbcf41d2d36549 class=toggle>
<label for=section-d0147c75204bce6530fbcf41d2d36549 class="flex justify-between"><a href=/chemu-ya-nauchilsya-u-bitcoina/>Чему я научился у Биткоина?</a></label><ul><li><a href=/chemu-ya-nauchilsya-u-bitcoina/filosofskie-uroki-bitcoina/>Часть1. Философские уроки Биткоина</a></li></ul></li><li><a href=/ne-shitcoin/>Биткоин, не щиткоин</a></li><li><a href=/neotemlemye-prava-sobstvennosti/>Неотъемлемые права собственности</a></li><li><a href=/manifest-kriptoanarhista/>Манифест криптоанархиста</a></li><li><a href=/manifest-shifropanka/>Манифест шифропанка</a></li><li><a href=/tyulpannaya-lihoradka/>Биткоин — современная голландская тюльпанная лихорадка?</a></li><li><a href=/vse-moshenniki/>Все — мошенники</a></li><li><a href=/svoboda-cennosti/>Свобода ценности</a></li><li><a href=/bitcoin-meme/>Биткоин — единственный реальный мем</a></li><li><a href=/nol-i-bitcoin/>Ноль и Биткоин</a></li><li><a href=/crypto-bro/>Дорогие крипто- и фиат-бро</a></li><li><a href=/boremsya-s-poddelnymi-bitcoin/>Боремся с поддельными биткоинами</a></li><li><a href=/bit%D1%81oin-eto-micelij/>Биткоин — это мицелий</a></li><li><a href=/pochemu-bitcoin-zhivoj-organizm/>Доказательство жизни. Почему Биткоин — живой организм</a></li><li><a href=/samaya-mirnaya-revolyuciya/>Самая мирная революция</a></li><li><a href=/o-bitcoin-vselennoj/>О Биткоин-вселенной</a></li><li><a href=/bitcoin-dissidenty/>Биткоин-диссиденты</a></li><li><a href=/bitcoin-svoboda/>Биткоин = свобода</a></li></ul></li><li><input type=checkbox id=section-fdb518469e72600e21abd65af5ea6171 class=toggle>
<label for=section-fdb518469e72600e21abd65af5ea6171 class="flex justify-between"><a href=/future/>Будущее</a></label><ul><li><input type=checkbox id=section-b59a8856c56e2e0372711e9188dfebe9 class=toggle>
<label for=section-b59a8856c56e2e0372711e9188dfebe9 class="flex justify-between"><a href=/ba/>Биткоин-астрономия</a></label><ul><li><a href=/ba/1/>Постгипербиткоинизация</a></li><li><a href=/ba/2/>Миллион крошечных миров</a></li><li><a href=/ba/3/>Первый контакт</a></li></ul></li><li><a href=/ej-bitcoin-pritormozi/>Эй, Биткоин, притормози</a></li><li><a href=/apokalipsis/>Сможет ли Биткоин пережить апокалипсис?</a></li><li><a href=/bitcoin-i-teplovaya-energiya-okeanov/>Биткоин и тепловая энергия океанов</a></li></ul></li><li><input type=checkbox id=section-43599378ef9b0927116f5c672d4753eb class=toggle>
<label for=section-43599378ef9b0927116f5c672d4753eb class="flex justify-between"><a href=/lightning/>Лайтнинг</a></label><ul><li><a href=/chto-takoe-laitning/>Что такое Лайтнинг?</a></li><li><a href=/lajtning-koshelki/>Лайтнинг-кошельки</a></li><li><a href=/lajtning-adresa/>Лайтнинг-адреса</a></li><li><a href=/privatnost-v-lajtning/>Приватность в сети Lightning</a></li><li><a href=/centralizovanna-li-set-lightning/>Централизованна ли сеть Lightning?</a></li><li><a href=/mekhanizm-raboty-lightning/>Механизм работы Lightning Network</a></li><li><a href=/problema-vhodyashchej-likvidnosti/>Решение проблемы входящей ликвидности</a></li></ul></li></ul></li><li><input type=checkbox id=section-d4e0b36756ff8942d2ab4055a855ff29 class=toggle checked>
<label for=section-d4e0b36756ff8942d2ab4055a855ff29 class="flex justify-between"><a href=/practice/>Практика</a></label><ul><li><input type=checkbox id=section-306de2e6e6c2e950b9ae3bd383e891b8 class=toggle>
<label for=section-306de2e6e6c2e950b9ae3bd383e891b8 class="flex justify-between"><a href=/practice/buy/>Покупка</a></label><ul><li><a href=/newbie-buy/>Покупка и хранение биткоина для новичков</a></li><li><a href=/hodl-hodl/>Покупка биткоина без KYC на Hodl Hodl</a></li><li><a href=/robosats/>RoboSats: Приватный p2p обмен</a></li></ul></li><li><input type=checkbox id=section-7e507c15445415f4a6c6ff107fd5be67 class=toggle>
<label for=section-7e507c15445415f4a6c6ff107fd5be67 class="flex justify-between"><a href=/practice/hodl/>Хранение</a></label><ul><li><a href=/electrum/>Кошелек Электрум</a></li><li><a href=/blue/>Кошелек Blue</a></li><li><a href=/seedsigner/>SeedSigner: оффлайн-крепость для ваших биткоинов</a></li><li><a href=/holodnyj-koshelek-iz-starogo-smartfona/>Холодный кошелек из старого смартфона</a></li><li><a href=/coldcard/>Что такое Coldcard?</a></li></ul></li><li><input type=checkbox id=section-cc823275546413520de75cb290b6340f class=toggle>
<label for=section-cc823275546413520de75cb290b6340f class="flex justify-between"><a href=/practice/interact/>Взаимодействие</a></label><ul><li><a href=/practice/bitcoin-node/>Каждому следует запустить собственную Биткоин-ноду!</a></li><li><a href=/orangepilling-in-5-min/>Оранжпиллинг за 5 минут</a></li><li><a href=/5-tips-for-teaching-bitcoin/>5 советов по обучению Биткоину</a></li></ul></li><li><input type=checkbox id=section-15aa48ccf00c4a6077461082e56e8a87 class=toggle>
<label for=section-15aa48ccf00c4a6077461082e56e8a87 class="flex justify-between"><a href=/docs/Practice/security/>Практики безопасности</a></label><ul><li><a href=/pgp-verify/>Проверка подлинности программ с помощью PGP</a></li></ul></li><li><input type=checkbox id=section-7a6d0f6b85d630f151cfac100463320e class=toggle>
<label for=section-7a6d0f6b85d630f151cfac100463320e class="flex justify-between"><a href=/practice-privacy/>Практики приватности</a></label><ul><li><input type=checkbox id=section-0937c773447ed958013e7f991c3cfc8e class=toggle>
<label for=section-0937c773447ed958013e7f991c3cfc8e class="flex justify-between"><a href=/practice-privacy/dojo/>Установка Биткоин-узла Dojo на x86</a></label><ul><li><a href=/practice-privacy/dojo-0/>Введение</a></li><li><a href=/practice-privacy/dojo-1/>Установка Bitcoin Core и Tor</a></li><li><a href=/practice-privacy/dojo-2/>Установка индексатора Fulcrum</a></li><li><a href=/practice-privacy/dojo-3/>Установка блокчейн-обозревателя Mempool</a></li><li><a href=/practice-privacy/dojo-4/>Установка Samourai Dojo</a></li><li><a href=/practice-privacy/dojo-5/>Конфигурация межсетевого экрана</a></li><li><a href=/practice-privacy/dojo-6/>Установка обновлений пакетов</a></li></ul></li><li><a href=/practice-privacy/ronindojo/>Установка RoninDojo на x86</a></li><li><a href=/grapheneos/>GrapheneOS: Избавляемся от слежки Google на смартфоне</a></li></ul></li><li><input type=checkbox id=section-9ce9af3be32641dfee9cee88793362a5 class=toggle checked>
<label for=section-9ce9af3be32641dfee9cee88793362a5 class="flex justify-between"><a href=/practice/lightning/>Лайтнинг на практике</a></label><ul><li><a href=/phoenix/>Кошелек Phoenix</a></li><li><a href=/lnbits/>LNbits – швейцарский нож среди лайтнинг-приложений</a></li><li><a href=/alby-i-nostr/>Alby и Nostr</a></li><li><a href=/zapplanner/>Подписки с помощью Лайтнинг</a></li><li><a href=/zapgram/>Телеграм-бот ZapGram</a></li><li><a href=/ochishchaem-bitcoin-cherez-lajtning/>Очищаем биткоины через сеть Лайтнинг</a></li><li><a href=/likvidnost-v-lajtning/ class=active>Руководство по управлению ликвидностью в сети Lightning</a></li><li><a href=/mutiny/>Кошелек Mutiny</a></li></ul></li></ul></li><li><input type=checkbox id=section-8d344ddc25268a9861446f8e4c24f2ef class=toggle>
<label for=section-8d344ddc25268a9861446f8e4c24f2ef class="flex justify-between"><a href=/rabbithole/>Кроличья нора</a></label><ul><li><a href=/books/>Книги</a><ul></ul></li><li><a href=/videos/>Видео</a><ul></ul></li><li><a href=/audiobooks/>Аудиокниги</a><ul></ul></li><li><a href=/pods/>Подкасты</a><ul></ul></li></ul></li></ul><div class=menuSep></div><ul><li><a href=/posts/>Блог</a></li><li><a href=/glossary/>Глоссарий</a></li><li><a href=/calendar/>Биткоин-календарь</a></li><li><input type=checkbox id=section-380047aa906f67ecf269300a9eda240b class=toggle>
<label for=section-380047aa906f67ecf269300a9eda240b class="flex justify-between"><a href=/contribute/>Принять участие</a></label><ul><li><a href=/syntax/>Оформление статей</a></li><li><a href=/github/>Как добавить статью?</a></li><li><a href=/obsidian/>Публикация статей через Obsidian</a></li></ul></li><li><a href=/feedback/>Обратная связь</a></li></ul><div class=menuBlock><div id=metrics-container class=metrics-container><div id=metrics-label></div><div id=metrics-value></div></div></div></nav><footer><br><a class=menuSocialButton href=https://t.me/bitcoin21ideas target=_blank title=Telegram><svg viewBox="0 0 25 25"><path d="m12 0C5.373.0.0 5.373.0 12s5.373 12 12 12 12-5.373 12-12c0-6.627-5.373-12-12-12zm5.894 8.221-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002.0-.003.0-.005.0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121L8.32 13.617l-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/></svg>
</a>&nbsp;
<a class=menuSocialButton href=https://github.com/21ideas-org/21ideas.org target=_blank title=GitHub><svg viewBox="0 0 820 820"><path d="M4e2 9.9C179.11 9.9.0 189 0 409.94.0 585.6 113.24 734.86 270.71 788.61l2.83.83c20 3.76 27.34-8.59 27.34-19.24.0-9.49-.32-34.68-.5-68-111.27 24.14-134.75-53.68-134.75-53.68a106.58 106.58.0 00-44.09-58.26l-.43-.24c-36.23-24.81 2.8-24.3 2.8-24.3A84.06 84.06.0 01185 606.54l.22.4a85.24 85.24.0 00116.92 33l-.43.21A85.16 85.16.0 01327 586.7C238.19 576.67 144.8 542.25 144.8 389c0-.72.0-1.55.0-2.38a153.82 153.82.0 0141.27-105l-.08.11a139.82 139.82.0 01-8.56-48.58 141.91 141.91.0 0112.4-58.21l-.37.91s33.51-10.72 110 41c30-8.56 64.43-13.5 1e2-13.5a378.09 378.09.0 01102.68 14.14l-2.67-.64c76-51.72 109.51-41 109.51-41a144 144 0 0112 58.07 145.56 145.56.0 01-8.35 48.82l.32-1a154.37 154.37.0 0141 105c0 .83.0 1.63.0 2.43V389c0 153.68-93.5 187.51-182.52 197.35a95.48 95.48.0 0127.27 66.93c0 2.48-.11 5-.3 7.42v-.32c0 53.54-.51 96.54-.51 109.53.0 10.51 7 23 27.51 19C686.25 734.78 8e2 585.39 8e2 409.41 8e2 188.74 621.11 9.87 400.47 9.87H4e2z"/></svg>
</a>&nbsp;
<a class=menuSocialButton href=https://njump.me/npub1lm3f47nzyf0rjp6fsl4qlnkmzed4uj4h2gnf2vhe3l3mrj85vqks6z3c7l target=_blank title=Nostr><svg viewBox="0 0 820 820"><path d="M4e2 797.5c219.53.0 397.5-178 397.5-397.5S619.53 2.5 4e2 2.5 2.5 180.47 2.5 4e2 180.47 797.5 4e2 797.5zM598.23 242.15c6.82 8.46 10.35 18.14 11.45 28.86 1.7 16.37-2.68 31.17-11.2 45-14.19 23.62-43.17 39.63-45.85 41-5.42 2.86-7.42 7.12-7.06 13.34s-1.21 37.19-20 50.83c-9.68 7-48.64 16-66.6 19.05a28.61 28.61.0 00-13.18 5.37c-1 .67-2 1.36-3.2 2.06-6.82 4.27-31.23 38-35.31 45.48l10.66-3.27c21.2-6.53 66.85-20.6 69.52-21 9-1.4 15.89 1.22 20.34 7.79 3.63 5.41 7.18 10.81 10.75 16.25.61.94 1.23 1.87 1.85 2.81 1 1.54 2 3.08 2.93 4.62.48.78 1 1.55 1.45 2.32l1.52 2.38c.09.14.19.29.28.45a10.65 10.65.0 011.37 2.83c.24 1 .91 4.14-.92 6.09-1.7 1.77-4.63 1.77-6.21 1.34a15.65 15.65.0 01-5.6-2.8l-2.49-2.13c-2-1.71-5.73-2.56-8.71-2.44-3.41.13-8-1-10.11-2.37-4.2-2.74-5.35-9.56-5.35-9.68a3.51 3.51.0 00-3.72-2.86 18.58 18.58.0 00-6.28 1.15l-.78.25q-15 4.56-29.93 9.24h0l-14.31 4.45c-7.06 2.19-14.12 4.38-21.13 6.69a37.45 37.45.0 00-5.72 2.62c-.43.21-.84.43-1.25.64l-1.24.64h0c-.85.42-1.7.85-2.55 1.34l-.27.15a30.59 30.59.0 01-5.76 2.65c-7.12 2.13-13.39-1-16.32-8.1-1.88-4.63-.18-13.76.86-16.44 5.58-14.35 21.77-39.58 26.28-46.6.75-1.17 1.17-1.83 1.17-1.86-.36-.12-23.25 9.07-27 11.93-10.35 7.86-34.64 26.49-35 28.31A22.75 22.75.0 01331 508.13c-5.66 2.19-9.13 6.7-12.48 11.08.0.0-60.88 83.83-65 88.34l-.68.74c-2.83 3-12.28 13.16-15 18.13-.46.83-1.61 3.27-2.58 5.33-.6 1.26-1.13 2.38-1.38 2.89.0.05-.05.11-.08.17-.59 1.21-1.91 3.9-6.31 3.66s-4.79-6.12-5-9.09v-.4c-.54-6.88 1-13.7 4.63-20.82a6.46 6.46.0 01.31-.58c1-1.8 3.93-7 2.61-11.36s-2.61-11.14-.6-14.61c2.84-4.77 7.62-5.48 13.92-6.41l2.64-.41c5.29-.85 9.13-3.53 12.84-8.88 4.66-6.84 17-24.51 27.65-39.67C293.62 516 3e2 507 302.66 503.09a25.55 25.55.0 003.77-9.08c1.89-9.74 7.85-16.49 18.14-20.7 2.25-.85 43.17-35.06 43.17-39.45.0-3.1-4.45-4.87-7.92-5.78-.48-.12-26.24-6.82-37.92-12.12A88.58 88.58.0 01305 406.41c-7.53-5.54-22.23-3.16-25.3-2.67l-.27.05c-11 1.58-19.12 6.51-28.37 12.78-1.65 1.16-10.05 4.2-14.31 1.77-1.32-.75-2.9-1.6-4.65-2.54-9.16-4.92-22.91-12.31-28.59-20.9-3.11-4.69-2.68-12.42-.49-20.94 7.07-19.73 17.48-28.56 36.77-33.91 11.39-3.95 32.41-5.33 46.84-6.28 2.93-.19 5.59-.37 7.84-.54.12-.05.8-.09 1.94-.18 7-.51 31.32-2.27 49.13-11.39 1.61-.82 3.59-1.92 5.91-3.2 17.67-9.8 55.68-30.86 107.76-29.25 12.95.4 32.15 7.45 49.77 13.93 14.79 5.43 28.46 10.45 36.38 10.79 17.65.73 26.54-1.22 36.77-11.81 2.92-3.05 15.16-29.53 3.59-44a108.64 108.64.0 00-13.94-14.55q-2.28-1.94-4.59-3.85a183.79 183.79.0 01-15.8-14.29c-13.82-14.61-18.09-34.58-11.51-50.17 4.14-10.9 13-15.65 25.63-13.15 6.22 1.24 11.28 5.49 15.95 9.41a73.24 73.24.0 005.84 4.59c3.6 2.38 9.56 3.78 13.46 4.69 4.93 1.16 8.65 4.93 8.4 7.49s-6.7 4.75-13 4.26c-7.36-.49-20.09-.55-27.7 2-5.05 1.83-7.3 7.49-5.84 13 1.22 4.57 10.9 12.66 14.55 15.65 1.64 1.35 3.3 2.67 5 4C587.86 231.81 593.56 236.34 598.23 242.15z" fill-rule="evenodd"/></svg>
</a>&nbsp;
<a class=menuSocialButton href=/rss title=RSS><svg viewBox="-143 145 525 525"><path d="M113 145c-141.4.0-256 114.6-256 256s114.6 256 256 256 256-114.6 256-256S254.4 145 113 145zM43.1 518.7c-6.2 6.2-14.7 9.9-24.1 9.9-9.4.0-17.8-3.8-24-9.9-6.2-6.2-10-14.6-10-23.9.0-9.4 3.8-17.8 10-24s14.6-10 24-10 17.9 3.8 24 10c6.2 6.2 10 14.6 10 24C53 504.2 49.2 512.6 43.1 518.7zM104.8 529c-.1-32.1-12.5-62.3-35.1-84.9-22.6-22.6-52.8-35.2-84.7-35.2V360c46.6.0 88.7 19 119.3 49.6s49.5 72.8 49.6 119.4H104.8zm87.2.0c-.1-114.2-92.8-207.1-206.9-207.1V273c70.6.0 134.5 28.7 180.8 75.1 46.3 46.4 75 110.3 75.1 180.9H192z"/></svg>
</a>&nbsp;
<a class=menuSocialButton href=https://www.youtube.com/@21ideas target=_blank title=YouTube><svg viewBox="0 0 25 25"><path d="M12 0C5.373.0.0 5.373.0 12s5.373 12 12 12 12-5.373 12-12S18.627.0 12 0zm4.441 16.892c-2.102.144-6.784.144-8.883.0C5.282 16.736 5.017 15.622 5 12c.017-3.629.285-4.736 2.558-4.892 2.099-.144 6.782-.144 8.883.0C18.718 7.264 18.982 8.378 19 12c-.018 3.629-.285 4.736-2.559 4.892zM10 9.658l4.917 2.338L10 14.342V9.658z"/></svg></a></footer><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class="book-page book-page-page"><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Руководство по управлению ликвидностью в сети Lightning</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#ваша-прибыль-может-варьироваться>Ваша прибыль может варьироваться</a></li><li><a href=#множество-переменных>Множество переменных</a></li><li><a href=#принятие-решения-по-открытию-каналов>Принятие решения по открытию каналов</a></li><li><a href=#экономия-на-ончейн-комиссиях-за-открытие-канала-с-помощью-сгруппированных-открытий-batch-opens>Экономия на ончейн-комиссиях за открытие канала с помощью сгруппированных открытий (Batch Opens)</a></li><li><a href=#открытие-каналов-с-взаимным-финансированием>Открытие каналов с взаимным финансированием</a></li><li><a href=#ребалансировка-каналов>Ребалансировка каналов</a></li><li><a href=#управление-политикой-канала>Управление политикой канала</a></li><li><a href=#покупка-входящей-ликвидности>Покупка входящей ликвидности</a></li><li><a href=#lightning-loop>Lightning Loop</a></li><li><a href=#узел-lightning-loop>Узел Lightning Loop</a></li><li><a href=#высвобождение-незадействованного-капитала>Высвобождение незадействованного капитала</a></li></ul></li><li><a href=#результаты>Результаты</a><ul><li><a href=#мысли-вслух>Мысли вслух</a></li></ul></li><li><a href=#что-дальше>Что дальше?</a></li></ul></li></ul></nav></aside></header><div class=pageCover><picture><img src=/img/lln-263.jpg alt=Cover></picture></div><h1>Руководство по управлению ликвидностью в сети Lightning</h1><div class=pageDate>7 августа 2021 г.</div><article class=markdown><p>Джейсон Лопп: уроки, полученные при управлении узлом маршрутизации в сети Lightning.</p><blockquote class="book-hint btc">Перевод <a href=https://blog.lopp.net/lightning-network-liquidity-management-guide>статьи</a> Джемесона Лоппа подготовлен <a href=https://snort.social/p/npub10awzknjg5r5lajnr53438ndcyjylgqsrnrtq5grs495v42qc6awsj45ys7>Тони⚡️</a>. <a href=/contribute/>Поддержать проект</a>.</blockquote><p>С тех пор как люди начали запускать узлы Lightning в mainnet в начале 2018 года, некоторые задавались вопросом: какую реальную прибыль можно ожидать от размещения капитала в маршрутизационной ноде? Ник Бхатия подробно описал свою теорию возможных вариантов развития событий:</p><div class=imageWrapper><img src=/img/lln-264.jpeg><p><em><a href=https://timevalueofbtc.medium.com/the-time-value-of-bitcoin-and-lnrr-e0c435931bd8>The Time Value of Bitcoin and LNRR</a></em></p></div><p>Но, как мы узнали за эти годы, ROI (возврат инвестиций/прибыль от инвестиций) включает в себя гораздо больше, чем просто вложение капитала в каналы Lightning.</p><blockquote class=twitter-tweet><p lang=en dir=ltr>Lightning routing is a multi-faceted competitive system. It’s not just about capital, a brute force deployment of capital will cripple ROI. The system models a distributed predictive cache. Available capital is a factor but so is intelligent capital placement, reliability, speed.</p>&mdash; Alex Bosworth (@alexbosworth) <a href="https://twitter.com/alexbosworth/status/994603452310278144?ref_src=twsrc%5Etfw">May 10, 2018</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>В начале 2021 года я решил попытаться определить, насколько хорошо я смогу управлять узлом с целью получения прибыли за счет маршрутизации средств.</p><blockquote class=twitter-tweet><p lang=en dir=ltr>If you're asking what is the ROI on a routing node, you're operating from an incorrect premise of how Lightning functions<br><br>A billion dollars can flow over a $5 channel. Managing to place and maintain that channel where a billion dollars needs to flow is the really difficult part.</p>&mdash; Alex Bosworth (@alexbosworth) <a href="https://twitter.com/alexbosworth/status/1358807809631035395?ref_src=twsrc%5Etfw">February 8, 2021</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>Я следовал процессу, описанному в моем предыдущем блог посте, поясняющем как создать свой узел, функционирующий исключительно через Tor:</p><div class=imageWrapper><img src=/img/lln-265.png><p><em><a href=https://blog.lopp.net/tor-only-bitcoin-lightning-guide>Tor-Only Bitcoin & Lightning Guide</a></em></p></div><p>Запустить программное обеспечение было проще простого. Далее мне нужно было понять, как наиболее эффективно разместить свой капитал.</p><h3 id=ваша-прибыль-может-варьироваться>Ваша прибыль может варьироваться
<a class=anchor href=#%d0%b2%d0%b0%d1%88%d0%b0-%d0%bf%d1%80%d0%b8%d0%b1%d1%8b%d0%bb%d1%8c-%d0%bc%d0%be%d0%b6%d0%b5%d1%82-%d0%b2%d0%b0%d1%80%d1%8c%d0%b8%d1%80%d0%be%d0%b2%d0%b0%d1%82%d1%8c%d1%81%d1%8f>#</a></h3><p>К сожалению, невозможно написать руководство, которое предоставило бы простые инструкции в стиле: &ldquo;Подключитесь к этим узлам и получайте комиссионные&rdquo;. Необходимо рассматривать Lightning Network как конкурентный рынок, предлагающий эффективное передвижение капитала. Как и в случае с определенной торговой стратегией, если все начнут прибегать к одним и тем же техникам, все преимущества, присущие этой стратегии, исчезнут, и это создаст возможности для других участников торговать против нее. Если все будут строить одни и те же мосты для перемещения капитала, это превратится в гонку на износ в конкуренции за комиссионные, и для других операторов будет разумнее &ldquo;противодействовать&rdquo; этой стратегии, строя мосты в другом месте.</p><h3 id=множество-переменных>Множество переменных
<a class=anchor href=#%d0%bc%d0%bd%d0%be%d0%b6%d0%b5%d1%81%d1%82%d0%b2%d0%be-%d0%bf%d0%b5%d1%80%d0%b5%d0%bc%d0%b5%d0%bd%d0%bd%d1%8b%d1%85>#</a></h3><p>Вы, наверное, заметили, что эта статья получилась очень длинной. Причина тому — наличие множества различных вопросов, которые необходимо учитывать при эксплуатации узла Lightning Network с целью максимизации маршрутизации. К ним относятся:</p><ul><li>Размещение капитала</li><li>Комиссии за маршрутизацию</li><li>Минимизация ончейн-комиссий</li><li>Ваша общая входящая/исходящая емкость</li><li>Поддержание пропускной способности маршрутизации (ребалансировка / Submarine Swaps)</li><li>Входящая / исходящая емкость пользователей</li><li>Безотказность / время работы / здоровье узлов</li><li>Безотказность / нагрузка / сетевое подключение вашего узла</li></ul><h3 id=принятие-решения-по-открытию-каналов>Принятие решения по открытию каналов
<a class=anchor href=#%d0%bf%d1%80%d0%b8%d0%bd%d1%8f%d1%82%d0%b8%d0%b5-%d1%80%d0%b5%d1%88%d0%b5%d0%bd%d0%b8%d1%8f-%d0%bf%d0%be-%d0%be%d1%82%d0%ba%d1%80%d1%8b%d1%82%d0%b8%d1%8e-%d0%ba%d0%b0%d0%bd%d0%b0%d0%bb%d0%be%d0%b2>#</a></h3><p>Алекс Босворт предоставляет подробное руководство <a href=https://github.com/alexbosworth/run-lnd/blob/master/LIQUIDITY.md>в этом документе</a>.</p><p>Открыть каналы Lightning очень просто — подавляющее большинство узлов в сети примут входящий канал практически любой емкости. Таким образом, есть опасность заблокировать капитал у плохо функционирующего узла, который не обрабатывает значительного количества платежей. А если ваш <em>пир</em> (держатель узла, с которым вы открыли канал) перестает отвечать, закрытие канала может привести к тому, что ваш капитал окажется в бездействии на несколько недель.</p><p>В ходе моих первоначальных экспериментов я обнаружил, что некоторые узлы просто не маршрутизируются, возможно, потому, что у них недостаточно ликвидности, направленной другим узлами. Довольно сложно сказать, каков будет статус пиров, не исследуя различные маршруты, проходящие через них, что изначально требует открытия канала. Я ожидаю, что в будущем появятся сервисы, которые помогут решить эту проблему и дадут больше информации о состоянии ликвидности того или иного узла.</p><p>Что бы вы ни делали, <strong>избегайте использования автопилота lnd</strong>; он просто подключается к крупным популярным узлам. Аналогично, похоже, что многие просто заходят на Lightning Terminal или 1ML и подключаются к узлам с самым высоким рейтингом. Это может звучать нелогично, но такая стратегия не является выигрышной, если вы хотите, чтобы ваш узел направлял большое количество платежей. Скорее, <strong>вы должны стремиться к созданию новых мостов</strong>, связывая между собой узлы, которым в противном случае пришлось бы совершить много <em>хопов</em> (перенаправлений/прыжков) для маршрутизации друг к другу.</p><p>Еще одна проблема, с которой я сталкивался, — это использование оценки BOS для решения с какими узлами открывать каналы. Алекс Босворт, который написал алгоритм подсчета баллов, сказал мне, что он не был задуман как система подбора узлов маршрутизации/оценки качества.</p><p>Я использовал инструмент подбора узлов (<a href=https://moneni.com/nodematch>node match tool</a>), чтобы выяснить, какие узлы больше всего повысят мою центрированность. Однако я бы еще раз предостерег от слепого открытия каналов с узлами, получившими наивысший рейтинг. Прежде чем открыть канал с одним из рекомендованных узлов, я проверяю его на <a href=https://terminal.lightning.engineering/>Lightning Terminal</a>, чтобы убедиться в его стабильности. Затем я проверяю его на <a href=https://1ml.com/>1ML</a>, чтобы убедиться, что они устанавливают разумную политику комиссионных сборов.</p><div class=imageWrapper><img src=/img/lln-266.png></div><p>Чтобы получить альтернативный взгляд на то, как повысить центрированность узла, я использовал скрипт Gridflare &ldquo;<a href=https://github.com/Gridflare/lndpytools/blob/main/improvecentrality.py>improve centrality</a>&rdquo; от <a href=https://github.com/Gridflare/lndpytools>lndpytools</a>. Он, конечно, не так удобен в использовании, как другие веб-инструменты, так как требует получения полного дампа сетевого графа с вашего узла, переноса его на настольный компьютер / ноутбук, а затем запуска анализа на этом json-файле.</p><div class=imageWrapper><img src=/img/lln-267.png></div><p>Мой опыт подсказывает, что большинство &ldquo;высокосвязанных&rdquo; узлов с 500+ каналами, как правило, нестабильны и поэтому не направляют много платежей. Я подозреваю, что они слишком сильно нагружают свое оборудование. Однако другие пользователи сообщают о другом опыте — ваша прибыль может варьироваться!</p><p>Если вы можете себе это позволить, не создавайте каналы размером менее 10M (миллионов) сат. Имейте в виду, что максимальный размер платежа по умолчанию составляет чуть более 4M сат. Поэтому, если вы хотите иметь возможность поддерживать каналы, которые могут маршрутизировать максимальный размер платежа в любом направлении, вам нужно, по крайней мере, удвоить этот объем, а лучше еще сильнее его увеличить, поскольку довольно сложно иметь достаточно входящей ликвидности и достаточно исходящей ликвидности на обеих сторонах канала. Если вы не пытаетесь управлять узлом маршрутизации, это не так важно. Также можно быть узлом маршрутизации больших объемов платежей с меньшими каналами — скорее всего, вам придется делать больше ребалансировок — но все же желательно, чтобы пропускная способность вашего канала была как можно выше.</p><p>Если вы не можете позволить себе каналы в 10М сат, я бы посоветовал минимум 1М сат. Моя нода переслала 400 платежей за последние несколько месяцев, и средняя сумма пересылки составила 420,000 сат — около $150. Таким образом, вам потребуется почти идеально сбалансированный канал в 1М сат, чтобы иметь возможность переслать один средний платеж. Надеюсь, динамика изменится, когда все больше и больше кошельков начнут использовать <a href=https://t.me/bitcoin21ideas/1427>многоходовые</a> (multi-path) платежи.</p><p>В lnd вы можете предотвратить входящие каналы меньше определенного размера, введя следующую строку в lnd.conf:</p><pre tabindex=0><code>minchansize=1000000
</code></pre><p>Не все узлы позволят вам открыть с ними канал, и они не объяснят, почему отклоняют ваш запрос на открытие. Например, я попытался открыть канал с узлом Zap и получил отказ, даже когда я попробовал максимальный (по умолчанию) размер канала.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ lncli openchannel --node_key 
</span></span><span style=display:flex><span>03b428ba4b48b524f1fa929203ddc2f0971c2077c2b89bb5b22fd83ed82ac2f7e1 --local_amt <span style=color:#ae81ff>16000000</span> --sat_per_vbyte <span style=color:#ae81ff>1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>lncli<span style=color:#f92672>]</span> rpc error: code <span style=color:#f92672>=</span> Unknown desc <span style=color:#f92672>=</span> received funding error from 03b428ba4b48b524f1fa929203ddc2f0971c2077c2b89bb5b22fd83ed82ac2f7e1: err<span style=color:#f92672>=</span>channel rejected
</span></span></code></pre></div><p>Перед открытием канала необходимо попытаться определить, какова будет политика маршрутизации контрагента. Например, LNBIG имеет довольно высокие комиссии 175ppm — какой смысл платить за входящую ликвидность на ваш узел, если люди будут избегать его использования из-за высоких комиссий?</p><p>Некоторые узлы имеют абсурдно высокие комиссии за маршрутизацию; например, я заметил, что на узлах OKEX и OKCoin базовая комиссия установлена на уровне 1М сатоши — $400! Я говорил об этом с генеральным директором OKCoin, и он сказал, что это сделано специально, чтобы препятствовать маршрутизации; я предложил им изменить конфигурацию, чтобы просто отклонять открытие входящих каналов.</p><h3 id=экономия-на-ончейн-комиссиях-за-открытие-канала-с-помощью-сгруппированных-открытий-batch-opens>Экономия на ончейн-комиссиях за открытие канала с помощью сгруппированных открытий (Batch Opens)
<a class=anchor href=#%d1%8d%d0%ba%d0%be%d0%bd%d0%be%d0%bc%d0%b8%d1%8f-%d0%bd%d0%b0-%d0%be%d0%bd%d1%87%d0%b5%d0%b9%d0%bd-%d0%ba%d0%be%d0%bc%d0%b8%d1%81%d1%81%d0%b8%d1%8f%d1%85-%d0%b7%d0%b0-%d0%be%d1%82%d0%ba%d1%80%d1%8b%d1%82%d0%b8%d0%b5-%d0%ba%d0%b0%d0%bd%d0%b0%d0%bb%d0%b0-%d1%81-%d0%bf%d0%be%d0%bc%d0%be%d1%89%d1%8c%d1%8e-%d1%81%d0%b3%d1%80%d1%83%d0%bf%d0%bf%d0%b8%d1%80%d0%be%d0%b2%d0%b0%d0%bd%d0%bd%d1%8b%d1%85-%d0%be%d1%82%d0%ba%d1%80%d1%8b%d1%82%d0%b8%d0%b9-batch-opens>#</a></h3><p>Если вы запускаете новый узел, вам будет необходимо открыть много каналов. Рассмотрите вариант сгруппированных/пакетных открытий каналов с помощью командной строки:</p><p>Пакетное открытие транзакции с помощью balanceofsatoshi (bos) и Electrum Desktop. Ниже приведено краткое описание процесса, но этот шаг включает в себя ончейн-транзакцию и, следовательно, возможную потерю средств, если вы допустите ошибку. На сайте Джестофера есть подробное руководство: <a href=http://satbase.org/bos-open/>http://satbase.org/bos-open/</a>.</p><ol><li><p>В Electrum Desktop перейдите в Tools > Settings, во вкладке &ldquo;Transactions&rdquo; активируйте &ldquo;Advanced preview”. Затем в Tools откройте диалоговое окно “Pay to many”.</p></li><li><p>На вашем узле, как пользователь bos, в интерфейсе командной строки введите следующую команду:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bos open &lt;node pubkey 1&gt; --amount &lt;channel size in sats 1&gt; &lt;pubkey 2&gt; --amount &lt;channel size 2&gt; &lt;pubkey 3&gt; --amount &lt;channel size 3&gt; &lt;pubkey 4&gt; --amount &lt;channel size 4&gt; &lt;pubkey 5&gt; --amount &lt;channel size 5&gt; &lt;pubkey 6&gt; --amount &lt;channel size 6&gt;
</span></span></code></pre></div><p>После нажатия Enter запустится счетчик на 10 минут, и вам нужно будет выполнить шаги с 3 по 5 в течение этих 10 минут. Следите за тем, чтобы не использовать Ctrl+C после запуска таймера! Если вы хотите отменить процесс и таймер, просто нажмите Enter в интерфейсе командной строки.</p></li><li><p>Не вводите никаких других команд в CLI, а просто скопируйте вывод команды &lsquo;bos open&rsquo;, который будет представлять собой список ончейн-адресов и сумму в биткоинах через запятую. Этот формат совместим с опцией Electrum &lsquo;pay to many&rsquo;.</p></li><li><p>В Electrum вставьте этот список в диалоговое окно pay-to-many, сохраните транзакцию, нажмите &lsquo;Pay&rsquo;, установите фиксированную комиссию как можно ниже, <a href=https://mempool.space/>основываясь на текущих условиях мемпула</a>. Убедитесь, что флажок RBF <strong>НЕ</strong> установлен. Затем нажмите &lsquo;Finalize&rsquo; и &lsquo;Sign&rsquo;, используя ваш аппаратный кошелек (или кошелек Electrum, если не используете аппаратный кошелек), но <strong>НЕ</strong> транслируйте транзакцию! Это сделает balanceofsatoshi.</p></li><li><p>После того, как транзакция будет финализирована и подписана, скопируйте подписанную необработанную транзакцию, вставьте ее в интерфейс командной строки и нажмите &lsquo;Enter&rsquo;. Через несколько секунд или минут bos отобразит идентификатор транзакции (transaction ID). Затем вы можете использовать собственный блокчейн-эксплорер узла для проверки статуса вашей пакетной транзакции.</p></li></ol><h3 id=открытие-каналов-с-взаимным-финансированием>Открытие каналов с взаимным финансированием
<a class=anchor href=#%d0%be%d1%82%d0%ba%d1%80%d1%8b%d1%82%d0%b8%d0%b5-%d0%ba%d0%b0%d0%bd%d0%b0%d0%bb%d0%be%d0%b2-%d1%81-%d0%b2%d0%b7%d0%b0%d0%b8%d0%bc%d0%bd%d1%8b%d0%bc-%d1%84%d0%b8%d0%bd%d0%b0%d0%bd%d1%81%d0%b8%d1%80%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5%d0%bc>#</a></h3><p>Если у вас есть друг, который готов с вами сотрудничать, вы можете немного сэкономить на ребалансировке/циклировании, инициализировав уже сбалансированный канал. Ознакомьтесь с необходимыми шагами для Алисы и Боба, использующими bos CLI:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>(</span>NODE 1: Bob<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>0<span style=color:#f92672>)</span> Run: bos open-balanced-channel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>1<span style=color:#f92672>)</span> enter remote node public key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>2<span style=color:#f92672>)</span> enter full channel size
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>3<span style=color:#f92672>)</span> enter fee rate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Open a new terminal window.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>4<span style=color:#f92672>)</span> Run: bos fund --fee-rate &lt;fee&gt; &lt;address&gt; &lt;amount in sats&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Copy the signed_transaction and go back to 1st window and paste
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>5<span style=color:#f92672>)</span> paste the signed_transaction to bos prompt in 1st window  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>NODE 2: Alice<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>0<span style=color:#f92672>)</span> Run: bos open-balanced-channel <span style=color:#f92672>(</span>it should see the request from node1 at this point<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>1<span style=color:#f92672>)</span> agree with funding rate <span style=color:#f92672>(</span>y/n<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Open a new terminal window.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>2<span style=color:#f92672>)</span> Run: bos fund --fee-rate &lt;fee&gt; &lt;address&gt; &lt;amount&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Copy the signed_transaction and go back to 1st window and paste
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>3<span style=color:#f92672>)</span> paste the signed_transaction to bos prompt in 1st window
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>4<span style=color:#f92672>)</span> hit enter and this should work.  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>check via: lncli pendingchannels
</span></span></code></pre></div><h3 id=ребалансировка-каналов>Ребалансировка каналов
<a class=anchor href=#%d1%80%d0%b5%d0%b1%d0%b0%d0%bb%d0%b0%d0%bd%d1%81%d0%b8%d1%80%d0%be%d0%b2%d0%ba%d0%b0-%d0%ba%d0%b0%d0%bd%d0%b0%d0%bb%d0%be%d0%b2>#</a></h3><p>В некоторых случаях у меня не получалось ребалансировать канал из-за недостаточной ликвидности. Если вы заметили, что канал никогда не удается ребалансировать и он никогда не используется для маршрутизации средств, вы можете рассмотреть вариант его закрытия и распределения капитала в другом месте.</p><p>Перед ребалансировкой каналов вы должны убедиться, что в этом есть экономический смысл. В противном случае вы просто попадете в петлю постоянной ребалансировки каналов, поскольку они редко остаются идеально сбалансированными. Слепая ребалансировка в поисках идеального баланса почти наверняка в конечном итоге обойдется вам дороже из-за комиссионных, чем вы заработаете на маршрутизации платежей. К счастью, в &lsquo;bos&rsquo; есть опция &ndash;dryrun, позволяющая узнать, какой будет комиссия.</p><p>Вы можете использовать bos для автоматической ребалансировки, но для того, чтобы убедиться, что вы не проводите неэкономичную ребалансировку, вам нужно установить вашу максимальную ставку комиссии на минимальную ставку комиссии / 2. Вы можете добиться этого, добавив следующую строку в /etc/crontab:</p><pre tabindex=0><code>*/10 * * * *     jameson /path/to/bos rebalance --max-fee-rate 5
</code></pre><p>В конце концов я наткнулся на инструмент <a href=https://github.com/C-Otto/rebalance-lnd>rebalance-lnd</a> Карстена Отто. Мне нравится этот инструмент для ребалансировки, потому что он делает дополнительный шаг в определении того, имеет ли данный маршрут ребалансировки экономический смысл.</p><p>Вот как рассчитывается экономическая целесообразность ребалансировки:</p><p>Допустим, у вашего узла есть два канала, для которых необходимо оценить ребалансировку — один на Bitfinex с 10M сат на вашей стороне и ставкой комиссии 1,000 ppm. У вашего узла также открыт канал с LOOP и взимает 5,000 ppm за пересылку средств. К сожалению, ваша сторона канала практически пуста.</p><p>Возможно, хорошей идеей будет перебросить средства с канала Bitfinex на канал LOOP. Если вы сделаете это для ребалансировки 4M сат, это будет означать следующее:</p><ol><li>После ребалансировки останется 6M сат, которые можно будет в последующем протолкнуть на сторону Bitfinex. Вы не заработаете 4M * 1,000 ppm = 4,000 сат за перевод средств, которые вы вывели со своей стороны канала в рамках ребалансировки в LOOP. Это цена упущенной возможности, которую вы заплатили.</li><li>Вы также должны оплатить все транзакционные издержки ребалансировки; это ваши прямые издержки.</li><li>Если вам повезет, вы сможете отправить эти 4M sat в LOOP и заработать 4M * 5,000 ppm = 20,000 sat. Это ваш потенциальный будущий доход.</li></ol><p>Транзакция ребалансировки имеет экономический смысл только в том случае, если потенциальный заработок превышает сумму альтернативных издержек и прямых затрат.</p><p>Но я быстро обнаружил следующий недостаток: ребалансировка обычно не стоит того. Похоже, что менее 5% моих попыток ребалансировки выполняются таким образом.</p><p>Я установил cronjob для запуска случайной ребалансировки каждые 5 минут, добавив следующую строку в /etc/crontab:</p><pre tabindex=0><code>*/5 * * * *     jameson /path/to/rebalance.py --to -1
</code></pre><p>На моем узле открыто несколько десятков каналов, но в любой момент времени только около 25% из них нуждаются в ребалансировке, согласно инструменту rebalance-lnd, который по умолчанию пытается сохранить по крайней мере 1M сат на каждой стороне канала. Эти значения по умолчанию вряд ли будут оптимальными для вашей ситуации. Запуская случайную попытку ребалансировки каждые 5 минут, я ожидаю, что каждый канал, нуждающийся в ребалансировке, будет пытаться ребалансироваться дважды в час.</p><p><strong>Предупреждение:</strong> <em>это может дорого обойтись, если ваши комиссионные ставки за каналы будут нереально высокими, а в будущем вы их снизите! Убедитесь, что вы понимаете последствия автоматизации действий, что стоит денег.</em></p><p><strong>Pro Tip:</strong> После того, как я в течение недели запускал ребалансировку каждые 5 минут, я узнал, что она заполняет различные панели управления тоннами неоплаченных счетов с истекшим сроком действия. Чтобы снизить эффект этой проблемы, я предлагаю установить следующие две конфигурации lnd:</p><pre tabindex=0><code>gc-canceled-invoices-on-startup=true  
gc-canceled-invoices-on-the-fly=true
</code></pre><h3 id=управление-политикой-канала>Управление политикой канала
<a class=anchor href=#%d1%83%d0%bf%d1%80%d0%b0%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-%d0%bf%d0%be%d0%bb%d0%b8%d1%82%d0%b8%d0%ba%d0%be%d0%b9-%d0%ba%d0%b0%d0%bd%d0%b0%d0%bb%d0%b0>#</a></h3><p>В конце концов, я наткнулся на <a href=http://bc1q2q74hl6k2lhm6nzfa9t8z64m4zxqt3xa5ng0t3/>charge-lnd</a>, который является инструментом для автоматического динамического изменения платы за маршрутизацию на моих каналах. Стоит отметить, что это далеко не идеальный инструмент, потому что, к сожалению, мы можем устанавливать только исходящие комиссии для каналов. Это ограничение протокола Lightning, а не инструмента; вы можете прочитать больше о дебатах по поводу поддержки платы за входящие каналы <a href=https://github.com/lightningnetwork/lightning-rfc/issues/835>в этой теме на github</a>.</p><p>Первоначально, в течение первых нескольких месяцев работы, я установил все тарифные политики для каналов:</p><pre tabindex=0><code>base_fee_msat: 5000  
fee_ppm: 2000
</code></pre><p>Эти тарифы на порядок выше, чем по умолчанию; я просто хотел посмотреть, клюнут ли пользователи сети. Однако мой узел лишь изредка направлял средства с такими комиссиями. Предположительно, либо мои комиссии были слишком высокими, либо мой узел был плохо расположен на сетевом графике.</p><p>Позже я установил следующую конфигурацию для charge-lnd:</p><pre tabindex=0><code>[proportional]  
chan.min_ratio = 0  
chan.max_ratio = 1  
strategy = proportional  
base_fee_msat = 1000  
min_fee_ppm = 10  
max_fee_ppm = 2000
</code></pre><p>И установил cronjob для ежечасного запуска charge-lnd, добавив следующую строку в /etc/crontab:</p><pre tabindex=0><code>0 * * * *     jameson /path/to/charge-lnd -c /path/to/charge.config
</code></pre><p>В течение 48 часов после включения этого динамического управления политиками я увидел, что мой узел начал маршрутизировать больше платежей.</p><p>Вы не должны запускать этот скрипт чаще, чем раз в час, поскольку эти обновления распространяются относительно медленно (1 минута на хоп/прыжок), и если вы будете менять тарифы слишком часто, удаленные узлы, которые решат маршрутизировать через вас, будут часто получать ошибки FEE_INSUFFICIENT и, возможно, занесут ваши каналы или узел в черный список на несколько часов. Также желательно уменьшить трафик сплетен (gossip traffic) в сети.</p><p>Через пару месяцев я все еще наблюдал только спорадическую маршрутизацию, поэтому я изменил значения комиссий на:</p><pre tabindex=0><code>min_fee_ppm = 2  
max_fee_ppm = 200
</code></pre><p>Стоит отметить, что использование динамического менеджера политики каналов несколько противоречит логике, используемой инструментом rebalance-lnd — он предполагает, что плата за канал останется неизменной в обозримом будущем, когда рассчитывает альтернативную стоимость, которую вы платите, перемещая ликвидность. Например, если rebalance-lnd использует текущую комиссионную ставку вашего канала, чтобы решить, когда проводить ребалансировку, а charge lnd меняет ставки комиссии, rebalance-lnd примет решение, которое имеет смысл для него при ставке комиссии A, но позже может появиться charge lnd и изменить ставку комиссии на B, что сделает логику rebalance-lnd для ставки комиссии A недействительной. Похоже, что rebalance-lnd должен знать конфигурацию charge lnd и исторический поток средств через канал, чтобы лучше предсказать будущий доход от комиссии.</p><h3 id=покупка-входящей-ликвидности>Покупка входящей ликвидности
<a class=anchor href=#%d0%bf%d0%be%d0%ba%d1%83%d0%bf%d0%ba%d0%b0-%d0%b2%d1%85%d0%be%d0%b4%d1%8f%d1%89%d0%b5%d0%b9-%d0%bb%d0%b8%d0%ba%d0%b2%d0%b8%d0%b4%d0%bd%d0%be%d1%81%d1%82%d0%b8>#</a></h3><p>Получение (и поддержание) входящей ликвидности — одна из самых больших проблем в работе узла маршрутизации.</p><p>По состоянию на 5 июля 2021 года стоимость покупки максимального количества входящей ликвидности (16,7 млн сат / $5,650) для канала через определенные сервисы составляет:</p><ul><li><a href=https://www.bitrefill.com/buy/lightning-channel/>Bitrefill</a>: 199,021 сат / $67</li><li><a href=https://yalls.org/about/>Y&rsquo;alls</a>: 150,000 сат / $50.44</li><li><a href=https://lnbig.com/#/open-channel>LNBIG</a>: 24,101 сат / $8.30</li><li><a href=https://github.com/lightninglabs/loop>Loop</a>: 26,165 сат / $8.81</li><li><a href=https://github.com/lightninglabs/pool>Pool</a>: неизвестно (аукционы проводятся вслепую)</li></ul><p>Вы также можете использовать следующие сервисы для открытия канала и получения ответного канала или получения средств ончейн:</p><ul><li><a href=https://lightningconductor.net/channels>https://lightningconductor.net/channels</a></li><li><a href=https://ln2me.com/>https://ln2me.com/</a></li></ul><p>Эти методы требуют доверия к сервису в возврате средств. Решение, требующее меньшего доверия, заключается в использовании функции bos dual-funded channel open (двустороннее открытие канала), о которой говорилось ранее, хотя для этого необходимо найти контрагента, который достаточно подкован, чтобы использовать balanceofsatoshis CLI.</p><p>Если у вас есть аккаунт на бирже, которая поддерживает депозиты Lightning, вы можете отправить на биржу, а затем выполнить вывод средств ончейн, увеличив таким образом свою входящую ликвидность. Несколько лет назад я <a href="https://www.youtube.com/watch?v=HtU7ZlxvLL4&amp;feature=youtu.be&amp;t=273">проводил презентацию</a> о важности подключения бирж к Lightning Network для повышения ликвидности в сети.</p><p>Наконец, вы можете использовать различные каналы связи для координации обмена ликвидностью.</p><ul><li><a href=https://lightningnetwork.plus/>https://lightningnetwork.plus/</a></li><li><a href="https://www.reddit.com/r/TheLightningNetwork/search?sort=new&amp;restrict_sr=on&amp;q=flair%3ALiquidity%2BSwaps">Reddit Lightning Triangles</a></li><li><a href=https://t.me/theRingsOfFire>Rings of Fire</a></li><li><a href=https://t.me/Plebnet>Plebnet</a></li></ul><p>Если вы являетесь пользователем balanceofsatoshis, bos упрощает процесс обмена ликвидностью с помощью функции</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bos increase-inbound-liquidity --amount &lt;sats&gt; --with &lt;pubkey&gt;
</span></span></code></pre></div><p>Имейте в виду, что каждый такой своп обычно занимает час.</p><p>Однако стоит отметить, что нет никаких гарантий, когда речь идет о входящей ликвидности. Контрагенты по каналу всегда могут закрыть канал, если решат, что их капитал распределен не лучшим образом!</p><p>Исключением является Lightning Pool, в котором вы заключаете контракт на покупку ликвидности на определенный срок, и эта продолжительность фактически обеспечивается на уровне блокчейна. Согласно их <a href=https://github.com/lightninglabs/pool-paper/blob/main/liquidity.pdf>whitepaper</a>:</p><div class=imageWrapper><img src=/img/lln-268.png></div><p>Надеюсь, в ближайшем будущем мы также получим встроенные <a href=https://bitcoinops.org/en/newsletters/2021/07/28/#c-lightning-4639>объявления о ликвидности</a>, доступные на уровне протокола.</p><h3 id=lightning-loop>Lightning Loop
<a class=anchor href=#lightning-loop>#</a></h3><p>Я надеялся, что получать входящую ликвидность через сервис Lightning Loop будет проще и безопаснее, чем доверять различным сторонним сервисам. Настроить loopd и использовать loop в командной строке оказалось невероятно просто.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ./loop quote out -v <span style=color:#ae81ff>16777215</span>  
</span></span><span style=display:flex><span>Send off-chain: <span style=color:#ae81ff>16777215</span> sat  
</span></span><span style=display:flex><span>Receive on-chain: <span style=color:#ae81ff>16759995</span> sat  
</span></span><span style=display:flex><span>Estimated on-chain fee: <span style=color:#ae81ff>338</span> sat  
</span></span><span style=display:flex><span>Loop service fee: <span style=color:#ae81ff>16882</span> sat  
</span></span><span style=display:flex><span>Estimated total fee: <span style=color:#ae81ff>17220</span> sat  
</span></span><span style=display:flex><span>No show penalty <span style=color:#f92672>(</span>prepay<span style=color:#f92672>)</span>: <span style=color:#ae81ff>30000</span> sat
</span></span></code></pre></div><p>Похоже, что <a href=https://docs.lightning.engineering/lightning-network-tools/loop/autoloop>Autoloop</a> также должен быть довольно прост в настройке, хотя я не уверен, что он действительно необходим для узла маршрутизации. Я не решаюсь установить автолупинг (autolooping), потому что большинство лупов, производящихся вручную (manual loops), которые я пытаюсь сделать, не завершаются успехом.</p><p>Сложность в создании лупов для получения входящей ликвидности заключается в том, что:</p><ol><li>Это должно быть сделано для довольно большой суммы, чтобы ончейн-комиссия оправдала себя.</li><li>Чем большую сумму вы пытаетесь вывести, тем сложнее найти путь для перенаправления средств оффчейн.</li></ol><p>Подавляющее большинство моих попыток вывести большие объемы потерпели неудачу из-за проблем с lightning-маршрутизацией. Например, мой узел в течение 20 минут пытался найти способ направить 4М сат с узла Blockstream. Я подозреваю, что у них не так много исходящей ликвидности; поскольку это магазин, где большая часть ликвидности, вероятно, направлена в его сторону, как на получателя платежей.</p><h3 id=узел-lightning-loop>Узел Lightning Loop
<a class=anchor href=#%d1%83%d0%b7%d0%b5%d0%bb-lightning-loop>#</a></h3><p>В качестве теста я открыл канал с узлом <a href=https://amboss.space/node/021c97a90a411ff2b10dc2a8e32de2f29d2fa49d41bfbb52bd416e460db0747d0d>LOOP</a>, за что я заплатил 1 sat/b (154 sat) ончейн-комиссии.</p><p>В течение 5 часов по этому каналу было переслано 11 платежей, которые израсходовали 98% моей исходящей емкости на LOOP. Я заработал чуть более 3 000 сатоши в виде комиссии.</p><p>Затем узел LOOP закрыл мой канал с комиссией 2,5 сат/б (244 сат). Предположительно потому, что он был настолько несбалансированным, что у сервера loop не было возможности получить больше средств. Насколько я слышал, у них есть автоматическое закрытие, когда ваш локальный баланс составляет 20% или ниже. Я получил 2,600 сат; звучит довольно неплохо, да?</p><p>LOOP, похоже, перерабатывает тонну каналов; из 48 каналов, открытых на момент написания статьи, их средний возраст составляет 16 дней, и, похоже, он закрывает от 5 до 10% открытых каналов каждый день.</p><p>Далее я попробовал открыть большой канал с LOOP, для которого я установил очень высокую ставку комиссии в 1%, чтобы посмотреть, не клюнет ли кто-нибудь.  </p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lncli updatechanpolicy --base_fee_msat <span style=color:#ae81ff>5000</span> --fee_rate 0.01 --time_lock_delta <span style=color:#ae81ff>18</span> --chan_point &lt;UTXO&gt;
</span></span></code></pre></div><p>Мне также пришлось обновить конфигурацию &ldquo;charge&rdquo;, чтобы она игнорировала этот канал и не снижала плату автоматически.</p><pre tabindex=0><code>[loop]  
node.id = 021c97a90a411ff2b10dc2a8e32de2f29d2fa49d41bfbb52bd416e460db0747d0d  
strategy = ignore
</code></pre><p>Через несколько дней, когда не было проведено ни одного платежа, я уменьшил комиссию в два раза и заметил, что платежи стали редко, но поступать. Возможно, позже я попробую повторить этот эксперимент с каналом <a href=https://medium.com/breez-technology/mpps-wumbo-channels-optimizing-liquidity-on-the-lightning-network-6059bedea322>wumbo</a>.</p><p>Однако Алекс Босворт отметил, что это не будет простым циклом открытия каналов с большими объемами “под копирку” с узлом LOOP. Почему? Потому что каждый раз, когда вы это делаете, расходуется общая входящая ликвидность, поступающая в остальную часть сети по всем остальным вашим каналам. Итак, представьте, что у вашего узла в общей сложности 10М сат входящей ликвидности, а вы открываете каналы на 1М с узлом LOOP. Вы сможете повторить это только около 10 раз, прежде чем вы потеряете возможность направлять средства на узел LOOP.</p><p>После достаточного количества экспериментов и неудачных процедур <a href=https://lightning.engineering/loop/>loop out</a>, кажется, что выигрышная стратегия заключается в том, чтобы открыть большой канал с узлом LOOP, установить на нем высокие комиссии за маршрутизацию, чтобы он не истощался, а затем использовать узел для дешевой маршрутизации входящей ликвидности, поскольку вам не придется платить комиссии за маршрутизацию.</p><h3 id=высвобождение-незадействованного-капитала>Высвобождение незадействованного капитала
<a class=anchor href=#%d0%b2%d1%8b%d1%81%d0%b2%d0%be%d0%b1%d0%be%d0%b6%d0%b4%d0%b5%d0%bd%d0%b8%d0%b5-%d0%bd%d0%b5%d0%b7%d0%b0%d0%b4%d0%b5%d0%b9%d1%81%d1%82%d0%b2%d0%be%d0%b2%d0%b0%d0%bd%d0%bd%d0%be%d0%b3%d0%be-%d0%ba%d0%b0%d0%bf%d0%b8%d1%82%d0%b0%d0%bb%d0%b0>#</a></h3><p>Некоторые пиры никогда не маршрутизируют средства, потому что они нестабильны, поэтому я бы закрыл канал с ними — как мне казалось, что держать их открытыми — пустая трата капитала и бесполезное зондирование маршрутов. Но если пир не реагировал, когда я собирался закрыть канал, проводилось принудительное закрытие, в результате чего капитал оставался заблокированным более недели.</p><p>Нет особого смысла в блокировании средств в каналах, если эти средства не используются. К счастью, bos также позволяет довольно легко определить, от каких пиров стоит отказаться.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bos remove-peer --dryrun --idle-days <span style=color:#ae81ff>90</span> --fee-rate <span style=color:#ae81ff>5</span> --active
</span></span></code></pre></div><p>Также имеет место проблема пиров, которые слишком часто находятся оффлайн, что препятствует регулярному перенаправлению средств.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bos remove-peer --dryrun --idle-days <span style=color:#ae81ff>30</span> --fee-rate <span style=color:#ae81ff>5</span> --offline
</span></span></code></pre></div><p>Поскольку эти операции требуют ончейн-транзакций, я собираюсь отнести их к <a href=https://ru.wikipedia.org/wiki/Cron>cron-заданиям</a>, которые будут выполняться в выходные дни, когда комиссии ниже.</p><p>Однако, если вы собираетесь закрыть канал, вы можете попытаться использовать этот капитал для ребалансировки некоторых других каналов.</p><p>Вам также стоит закрыть каналы, которые не приносят вам большого дохода в виде комиссии за маршрутизацию:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bos peers --fee-days <span style=color:#ae81ff>60</span> --sort fee_earnings
</span></span></code></pre></div><p>Результаты этой команды также покажут вам, какие каналы, вероятно, стоит ребалансировать (те, которые приносят много комиссии за маршрутизацию).</p><h2 id=результаты>Результаты
<a class=anchor href=#%d1%80%d0%b5%d0%b7%d1%83%d0%bb%d1%8c%d1%82%d0%b0%d1%82%d1%8b>#</a></h2><p>После того, как я хорошо сбалансировал каналы, я подождал несколько недель, чтобы посмотреть, много ли я заработал на комиссиях.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ bos forwards --complete --days <span style=color:#ae81ff>90</span>
</span></span></code></pre></div><p>На дюжине каналов я заработал 17,025 сатоши в виде комиссии за маршрутизацию.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ bos chart-fees-earned
</span></span></code></pre></div><div class=imageWrapper><img src=/img/lln-269.png></div><p>Однако я потратил 31,897 сатоши на ончейн-транзакции.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ bos chart-chain-fees
</span></span></code></pre></div><div class=imageWrapper><img src=/img/lln-270.png></div><p>После еще одного месяца жонглирования моим узлом по выходным, переключения десятков каналов и добавления автоматики:</p><div class=imageWrapper><img src=/img/lln-271.png></div><p>Стоит отметить, что почти половина из 60,000 сатоши, которые были выплачены в качестве ончейн-комиссий, пришлась на <strong>одно принудительное закрытие канала</strong>. Это принудительное закрытие стоило более 100 сатоши за виртуальный байт, в то время как его можно было быстро подтвердить, заплатив около 5 сатоши за виртуальный байт. Оглядываясь назад, я думаю, что этого можно было бы избежать, если бы я был терпелив и подождал, пока этот пир вернется в сеть, прежде чем закрывать канал. Если бы не эта невынужденная ошибка, <em>я, вероятно, заработал бы больше на оффчейн-комиссиях, чем потратил на ончейн-транзакции на сегодняшний день</em>. Похоже, это распространенная проблема.</p><div class=imageWrapper><img src=/img/twitter-c_otto83-1417545255319134213.png><p><em><a href=https://web.archive.org/web/20210720180145/https://twitter.com/c_otto83/status/1417545255319134213>Источник</a></em></p></div><p>С другой стороны, якорные каналы (anchor channels) должны решить эту проблему, чтобы вам не приходилось полагаться на старые и завышенные комиссионные ставки. Начиная с lnd 0.13.0 вновь созданные каналы используют якоря по умолчанию; вам просто нужно убедиться, что у вас есть ~100,000 сат в своем ончейн-кошельке для использования в качестве комиссионного резерва.</p><p>Что касается оффчейн-комиссий, я рад видеть, что, хотя мои комиссии в ppm теперь ниже, я провожу транзакции более постоянно. За последние 90 дней я собирал в среднем 500 сат в день, а за последние 10 дней — 1,000 сатоши.</p><p>Хотя на момент написания статьи я не являюсь оператором прибыльного узла маршрутизации, я вижу свет в конце тоннеля и буду продолжать свои усилия по анализу и корректировке своего узла.</p><h3 id=мысли-вслух>Мысли вслух
<a class=anchor href=#%d0%bc%d1%8b%d1%81%d0%bb%d0%b8-%d0%b2%d1%81%d0%bb%d1%83%d1%85>#</a></h3><p>До обновления до lnd v0.13 мой (исключительно Tor) узел не мог подключаться к узлам IPV4, что значительно ограничивало мои возможности по развертыванию капитала. Если вы используете узел, работающий только через Tor, вы должны понимать, что вы будете в невыгодном положении, когда дело дойдет до получения входящей ликвидности от узлов, не работающих на Tor.</p><blockquote class=twitter-tweet><p lang=en dir=ltr>Unpopular Truth<br>Tor unfortunately makes LN too unreliable. During the best of times it causes routing to go a lot slower. During the worst of times routing stops working entirely. RPC ping with larger data reveals the response time stretching into tens of seconds which breaks LN.</p>&mdash; Warren Togami (@wtogami) <a href="https://twitter.com/wtogami/status/1405785148298338308?ref_src=twsrc%5Etfw">June 18, 2021</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>Как оператор, вы должны ориентироваться не только на балансы отдельных каналов, но и на общее соотношение входящей и исходящей ликвидности вашего узла. Например, если у вас 100М сат исходящей ликвидности, но только 10М сат входящей, большая часть этой исходящей ликвидности бесполезна. Получение входящей ликвидности — одна из самых больших проблем, с которой я столкнулся, даже после выполнения множества <em>loop out</em>’ов.</p><p>Код алгоритма Lightning Terminal Web закрыт; трудно сказать, сколько средств можно ему доверить. Кроме того, он будет считать ваш узел нестабильным, если время его безотказной работы будет ниже 99,9% — с этой точки зрения, <strong>запуск узла маршрутизации через домашнее интернет-подключение без регулярного резервного копирования вряд-ли является лучшей идеей</strong>. Забавно, но я заметил проблемы с надежностью у некоторых случайных пользователей, с которыми я переписывался в Telegram-группах, которые запускали свои узлы на Raspberry Pi дома. Исходя из моего личного опыта эксплуатации узлов Raspberry Pi дома в течение многих лет, я бы посоветовал купить мощный ИБП и подключить к нему модем, маршрутизатор и узел. И ничего больше. Поскольку все эти устройства потребляют довольно мало энергии, используя достойный ИБП, вы сможете поддерживать узел в режиме онлайн более часа, а то и дольше.</p><p>Если вы хотите попытаться улучшить свой показатель Lightning Terminal, ознакомьтесь с данным инструментом, который проводит обратную инженерию: <a href=https://lnrouter.app/scores/terminal>https://lnrouter.app/scores/terminal</a>.</p><p>Запуск других служб на вашем узле может быть проблематичным. Несмотря на то, что мой узел был мощным (16 ядер и 16 ГБ оперативной памяти), я заметил, что когда я запускал на нем сервер electrum и нагрузка на оборудование в среднем превышала 1,0, Lightning Terminal начинал сообщать, что мой узел &ldquo;нестабилен&rdquo;.</p><p>Работа узла маршрутизации и поиск потоков ликвидности похожи на глубоководную рыбалку. Вы знаете, что рыба где-то там, но вы не можете ее увидеть. Вам приходится постоянно забрасывать лески и сети, чтобы понять, где находятся потоки средств, к которым вы можете подключиться.</p><blockquote class=twitter-tweet><p lang=en dir=ltr>It can be hard to tell when you lose inbound liquidity on LN. Imagine you open a nice big channel to someone who has no inbound themselves. Then you route tons of sats there, great! You have inbound from them now, but they have no inbound, so now you have no more inbound. Sorry!</p>&mdash; Alex Bosworth (@alexbosworth) <a href="https://twitter.com/alexbosworth/status/1412788505818931200?ref_src=twsrc%5Etfw">July 7, 2021</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>Максимальный размер не-wumbo канала составляет 16.7М сат. По моему опыту, попытки маршрутизации платежей размером более 4M сат обычно вызывают проблемы. Помните, что по умолчанию максимальное значение одиночного платежа составляет чуть более 4М сат. Даже если ограничение на величину платежа будет снято, и все каналы будут идеально сбалансированы и иметь максимальную емкость, это поднимет максимальный возможный платеж до 8.3М сат.</p><p>Доктор Карстен Отто имеет массу полезных заметок на своем веб-сайте <a href=https://c-otto.de/>https://c-otto.de/</a>.</p><h2 id=что-дальше>Что дальше?
<a class=anchor href=#%d1%87%d1%82%d0%be-%d0%b4%d0%b0%d0%bb%d1%8c%d1%88%d0%b5>#</a></h2><p>Существует еще много возможностей для совершенствования инструментов, которые помогают операторам узла Lightning лучше понять управление ликвидностью и маршрутизацию.</p><p>Хотелось бы видеть более наглядные визуализации каналов, по которым пересылаются платежи. <a href=https://www.thunderhub.io/>Thunderhub</a>, например, может создавать струнные диаграммы, чтобы визуализировать эту активность; я надеюсь, что больше программного обеспечения для панелей управления Lightning начнет делать это автоматически.</p><div class=imageWrapper><img src=/img/lln-272.png></div><p>Было бы здорово, если бы вы могли легко отправлять сообщения операторам узлов-ровесников, чтобы спросить, как дела, или узнать их намерения. Теоретически вы можете использовать keysend для отправки им платежа в 1 сатоши со встроенным сообщением, но нет никакой гарантии, что оператор узла когда-либо увидит его. Для этого можно использовать &ldquo;bos send&rdquo;.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bos send &lt;key&gt; --message<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;hey what&#39;s up?&#34;</span>
</span></span></code></pre></div><p>С отправкой сообщений есть небольшая проблема. Операторы узлов могут не замечать их, потому что они не используют Thunderhub или не настроили канал Telegram для отправки сообщений bos, поэтому другие операторы узлов не утруждают себя отправкой сообщений, так как они могут быть пропущены.</p><p>Рене Пикардт и Стефан Рихтер опубликовали работу, в которой показали, что поиск оптимальных маршрутов значительно усложняется, если базовая плата не установлена на 0: <a href=https://arxiv.org/abs/2107.05322>https://arxiv.org/abs/2107.05322</a></p><p>Я видел множество операторов, устанавливающих базовую плату своей ноды на 0, но я подозреваю, что это ошибочное решение, которое практически ничего не улучшит на момент написания статьи — это теоретическая оптимизация, от которой ноды начнут получать выгоду, только если разработчики действительно реализуют алгоритм нахождения пути, предложенный Рене и Стефаном.</p><p>Кроме того, в статье не обсуждаются другие компромиссы, такие как введение векторов DoS. Подумайте, что когда ваш узел принимает HTLC для маршрутизации сат, узел должен сохранять данные, связанные с этим HTLC, в своей базе данных. Таким образом, если ваша базовая комиссия равна 0, то кто-то может направить миллионы миллисатоши через ваш узел, не заплатив за это высокую цену. Однако, в грандиозной схеме потенциальных атак это может быть мелочью по сравнению с другими известными проблемами, такими как <a href=https://bitcoinmagazine.com/technical/good-griefing-a-lingering-vulnerability-on-lightning-network-that-still-needs-fixing>griefing</a> и <a href=https://lists.linuxfoundation.org/pipermail/lightning-dev/2020-June/002735.html>вымогательство</a>, которые позволяют злоумышленнику бесплатно заблокировать много средств.</p><p>Также было бы здорово, если бы кто-нибудь создал инструмент для визуализации входящей/исходящей ликвидности вашего узла и входящей/исходящей ликвидности всех узлов-аналогов. Это несколько сложно выяснить (в силу самого дизайна сети Lightning), но, возможно, есть способ приблизительно оценить эти показатели с помощью тщательно построенного зондирования маршрута.</p><p>Если вы дочитали это эссе до конца, поздравляем! Надеюсь, теперь вам ясно, что Lightning Network — это целый новый мир, который нам предстоит не только изучить, но и построить.</p><p>Спасибо <a href=https://twitter.com/alexbosworth>Алексу Босворту</a>, <a href=https://twitter.com/ErinEMalone>Эрин Мэлоун</a> и доктору <a href=https://twitter.com/c_otto83>Карстену Отто</a> за рецензии и отзывы.</p></article><hr><i>Connect to our relay to leave a comment. <a href=https://21ideas.org/en/comments/>Details</a>.<br>Подключитесь к нашему релею, чтобы оставить комментарий. <a href=https://21ideas.org/comments/>Подробнее</a>.</i>
<zap-threads anchor=https://21ideas.org/likvidnost-v-lajtning/ author=npub1lm3f47nzyf0rjp6fsl4qlnkmzed4uj4h2gnf2vhe3l3mrj85vqks6z3c7l relays=wss://21ideas.nostr1.com disable=replyAnonymously legacy-url=true></zap-threads><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#ваша-прибыль-может-варьироваться>Ваша прибыль может варьироваться</a></li><li><a href=#множество-переменных>Множество переменных</a></li><li><a href=#принятие-решения-по-открытию-каналов>Принятие решения по открытию каналов</a></li><li><a href=#экономия-на-ончейн-комиссиях-за-открытие-канала-с-помощью-сгруппированных-открытий-batch-opens>Экономия на ончейн-комиссиях за открытие канала с помощью сгруппированных открытий (Batch Opens)</a></li><li><a href=#открытие-каналов-с-взаимным-финансированием>Открытие каналов с взаимным финансированием</a></li><li><a href=#ребалансировка-каналов>Ребалансировка каналов</a></li><li><a href=#управление-политикой-канала>Управление политикой канала</a></li><li><a href=#покупка-входящей-ликвидности>Покупка входящей ликвидности</a></li><li><a href=#lightning-loop>Lightning Loop</a></li><li><a href=#узел-lightning-loop>Узел Lightning Loop</a></li><li><a href=#высвобождение-незадействованного-капитала>Высвобождение незадействованного капитала</a></li></ul></li><li><a href=#результаты>Результаты</a><ul><li><a href=#мысли-вслух>Мысли вслух</a></li></ul></li><li><a href=#что-дальше>Что дальше?</a></li></ul></li></ul></nav></div></aside></main><script>"use strict";const METRICS={FEE:"fee",BLOCK:"block",PRICE:"price",SATS:"sats",BTC:"btc"};let currentMetric=METRICS.FEE,lastKnownValues={fee:{label:"Комиссия",value:"0 sat/vB"},block:{label:"Высота блока",value:"0"},price:{label:"Цена",value:"$0"},sats:{label:"Московское время",value:"00:00"},btc:{label:"",value:"1 BTC = 1 BTC"}};function formatSatsAsTime(e){const t=Math.round(e).toString().padStart(4,"0"),n=t.slice(0,-2),s=t.slice(-2);return`${n}:${s}`}function formatNumber(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}function updateDisplay(){const n=document.getElementById("metrics-label"),e=document.getElementById("metrics-value");if(!n||!e)return;const t=lastKnownValues[currentMetric];n.textContent=t.label,e.textContent=t.value,e.style.paddingTop=t.label?"0":"0.7rem"}async function updateMetrics(){try{const[t,n,e]=await Promise.all([fetch("https://mempool.space/api/v1/fees/recommended").then(e=>e.json()),fetch("https://mempool.space/api/blocks/tip/height").then(e=>e.json()),fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd").then(e=>e.json())]);lastKnownValues.fee.value=`${t.fastestFee} sat/vB`,lastKnownValues.block.value=formatNumber(n),lastKnownValues.price.value=`$${formatNumber(e.bitcoin.usd)}`;const s=Math.round(1e8/e.bitcoin.usd);lastKnownValues.sats.value=formatSatsAsTime(s),updateDisplay()}catch(e){console.error("Error fetching metrics:",e)}}function cycleMetric(){const e=Object.values(METRICS),t=e.indexOf(currentMetric);currentMetric=e[(t+1)%e.length],updateDisplay()}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("metrics-container");e&&(e.addEventListener("click",cycleMetric),updateMetrics(),setInterval(updateMetrics,6e4))})</script></body></html>