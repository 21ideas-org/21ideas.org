<!doctype html><html lang=en dir=ltr><head><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&display=swap" rel=stylesheet><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Lessons learned from running a routing node on the Lightning Network."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta name=lightning content="21ideas@getalby.com"><meta property="og:title" content="Lightning Liquidity Management Guide"><meta property="og:description" content="Lessons learned from running a routing node on the Lightning Network."><meta property="og:type" content="article"><meta property="og:url" content="https://21ideas.org/en/lightning-liquidity-management-guide/"><meta property="og:image" content="https://21ideas.org/img/lln-263.jpg"><title>Lightning Liquidity Management Guide | 21ideas</title>
<link rel=manifest href=/manifest.json><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon media="(prefers-color-scheme: dark)" sizes=180x180 href=/apple-touch-icon-dark.png><link rel=icon type=image/png media="(prefers-color-scheme: dark)" sizes=32x32 href=/favicon-32x32-dark.png><link rel=icon type=image/png media="(prefers-color-scheme: dark)" sizes=16x16 href=/favicon-16x16-dark.png><link rel=alternate hreflang=ru-RU href=https://21ideas.org/likvidnost-v-lajtning/ title="Руководство по управлению ликвидностью в сети Lightning"><link rel=stylesheet href=/book.min.a88fda41628a86b0aa4a3caa9c8ab466ee8e01a433898186e506a93fb98f1884.css integrity="sha256-qI/aQWKKhrCqSjyqnIq0Zu6OAaQziYGG5QapP7mPGIQ=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script><script defer src=/en.search.min.05dff3f422690a54d2e4a82801d50d875bfcbecb8b4f97baf8bbf394e5efba10.js integrity="sha256-Bd/z9CJpClTS5KgoAdUNh1v8vsuLT5e6+LvzlOXvuhA=" crossorigin=anonymous></script><script type=text/javascript src=https://unpkg.com/zapthreads@0.5.2/dist/zapthreads.iife.js></script><meta name=robots content="index, follow"><link rel=canonical href=https://21ideas.org/en/lightning-liquidity-management-guide/><script defer src=https://cloud.umami.is/script.js data-website-id=0affba7d-3c1d-4235-adb3-635b69b6f567></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/en/><picture><source srcset=/svg/logo_white.svg media="(prefers-color-scheme: dark)"><img src=/svg/logo_black.svg alt=Logo>
</picture><span>21ideas</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul class=book-languages><li><input type=checkbox id=languages class=toggle>
<label for=languages class="flex justify-between"><a role=button class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
English</a></label><ul><li><a href=https://21ideas.org/likvidnost-v-lajtning/>Русский</a></li></ul></li></ul><ul><li><input type=checkbox id=section-2c1fc68ff68c3e454d055a4d37a4816d class=toggle>
<label for=section-2c1fc68ff68c3e454d055a4d37a4816d class="flex justify-between"><a role=button>Start</a></label><ul><li><a href=/en/start/start/>Bitcoin Basics</a></li><li><a href=/en/start/guide/>Using Bitcoin</a></li><li><a href=/en/shitcoin-gambling-games/>Don’t Play Shitcoin Gambling Games</a></li></ul></li><li><input type=checkbox id=section-0e947b637002f54ca330500896114bfb class=toggle>
<label for=section-0e947b637002f54ca330500896114bfb class="flex justify-between"><a href=/en/theory/>Theory</a></label><ul><li><input type=checkbox id=section-c8c88ad6975c3c08b99f7a6aaa8233c7 class=toggle>
<label for=section-c8c88ad6975c3c08b99f7a6aaa8233c7 class="flex justify-between"><a href=/en/economics/>Economics</a></label><ul><li><input type=checkbox id=section-042039620ae77f503533b4129302aa25 class=toggle>
<label for=section-042039620ae77f503533b4129302aa25 class="flex justify-between"><a href=/en/gradually-then-suddenly/>Gradually, Then Suddenly</a></label><ul><li><a href=/en/gradually-then-suddenly/intro/>Intro</a></li><li><a href=/en/gradually-then-suddenly/bitcoin-cant-be-copied/>Bitcoin Can’t Be Copied</a></li><li><a href=/en/gradually-then-suddenly/bitcoin-is-not-too-volatile/>Bitcoin Is Not Too Volatile</a></li><li><a href=/en/gradually-then-suddenly/bitcoin-does-not-waste-energy/>Bitcoin Does Not Waste Energy</a></li><li><a href=/en/gradually-then-suddenly/bitcoin-is-not-too-slow/>Bitcoin is Not Too Slow</a></li><li><a href=/en/gradually-then-suddenly/bitcoin-fixes-this/>Bitcoin Fixes This</a></li><li><a href=/en/gradually-then-suddenly/bitcoin-not-blockchain/>Bitcoin, Not Blockchain</a></li><li><a href=/en/gradually-then-suddenly/bitcoin-is-not-backed-by-nothing/>Bitcoin is Not Backed by Nothing</a></li><li><a href=/en/gradually-then-suddenly/bitcoin-is-not-a-pyramid-scheme/>Bitcoin is Not a Pyramid Scheme</a></li><li><a href=/en/gradually-then-suddenly/bitcoin-cannot-be-banned/>Bitcoin Cannot be Banned</a></li><li><a href=/en/gradually-then-suddenly/bitcoin-is-not-for-criminals/>Bitcoin is Not for Criminals</a></li><li><a href=/en/gradually-then-suddenly/bitcoin-obsoletes-all-other-money/>Bitcoin Obsoletes All Other Money</a></li><li><a href=/en/gradually-then-suddenly/bitcoin-is-a-rally-cry/>Bitcoin is a Rally Cry</a></li><li><a href=/en/gradually-then-suddenly/bitcoin-is-common-sense/>Bitcoin is Common Sense</a></li><li><a href=/en/gradually-then-suddenly/bitcoin-is-antifragile/>Bitcoin is Antifragile</a></li><li><a href=/en/gradually-then-suddenly/bitcoin-is-one-for-all/>Bitcoin is One for All</a></li><li><a href=/en/gradually-then-suddenly/bitcoin-is-the-great-definancialization/>Bitcoin is the Great Definancialization</a></li></ul></li><li><input type=checkbox id=section-dcadc98a07b7e2ce216dc99178d52c35 class=toggle>
<label for=section-dcadc98a07b7e2ce216dc99178d52c35 class="flex justify-between"><a href=/en/discovering-bitcoin/>Discovering Bitcoin</a></label><ul><li><a href=/en/discovering-bitcoin/intro/>Introduction</a></li><li><a href=/en/discovering-bitcoin/about-time/>About Time</a></li><li><a href=/en/discovering-bitcoin/about-people/>About People</a></li><li><a href=/en/discovering-bitcoin/introducing-money/>Introducing Money</a></li><li><a href=/en/discovering-bitcoin/a-wrong-turn-new-plan-needed/>A Wrong Turn (New Plan Needed)!</a></li><li><a href=/en/discovering-bitcoin/digital-scarcity/>Digital Scarcity</a></li><li><a href=/en/discovering-bitcoin/digital-contracts/>Digital Contracts</a></li><li><a href=/en/discovering-bitcoin/the-missing-pieces/>The Missing Pieces</a></li></ul></li><li><a href=/en/bitcoin-is-not-harmful-for-the-environment/>Bitcoin Is Not Harmful For The Environment</a></li><li><a href=/en/seven-network-effects-of-bitcoin/>The Seven Network Effects of Bitcoin</a></li><li><a href=/en/masters-and-slaves-of-money/>Masters and Slaves of Money</a></li><li><a href=/en/structural-adjustment/>Structural Adjustment</a></li><li><a href=/en/in-defense-of-deflation/>In Defense Of Deflation</a></li><li><a href=/en/comparison-of-monetary-standards/>Comparison of Monetary Standards</a></li><li><a href=/en/petrodollar-negative-effects/>Petrodollar Negative Effects</a></li><li><a href=/en/shelling-out/>Shelling Out: The Origins of Money</a></li><li><a href=/en/bitcoin-rhythms-of-history/>Bitcoin and the Rhythms of History</a></li><li><a href=/en/bitcoin-and-the-hopf-cycle-of-the-internet/>Bitcoin & the HOPF Cycle of the Internet</a></li><li><a href=/en/money-blockchains-and-social-scalability/>Money, blockchains, and social scalability</a></li><li><a href=/en/what-is-money/>What Is Money</a></li><li><a href=/en/only-the-strong-survive/>Only The Strong Survive</a></li><li><a href=/en/dollar-cost-averaging/>Dollar-Cost Averaging</a></li><li><a href=/en/jevons-paradox/>Jevons Paradox: Contrary Truth</a></li></ul></li><li><input type=checkbox id=section-7607f4888796b50750900ae1fa41174c class=toggle>
<label for=section-7607f4888796b50750900ae1fa41174c class="flex justify-between"><a href=/en/security/>Security</a></label><ul><li><a href=/en/how-to-hold-private-keys/>Bitcoin Wallets: How, Why and When to Hold Your Own Private Keys</a></li><li><a href=/en/seed/>What is a bitcoin seed phrase and how does it work?</a></li><li><a href=/en/seed-security/>Ultimate guide to storing your bitcoin seed phrase backups</a></li><li><a href=/en/passphrase/>Is your passphrase strong enough?</a></li><li><a href=/en/what-is-multisig/>What is multisig?</a></li><li><a href=/en/hwws/>The best Bitcoin hardware wallets</a></li><li><a href=/en/multisig-1/>Multisig Part I: Why Multisig?</a></li><li><a href=/en/multisig-2/>Multisig Part II: Single Keys are the Foundation of Multisignature</a></li></ul></li><li><input type=checkbox id=section-6e81d9ae00d8c0e44f4b6c22008f433f class=toggle>
<label for=section-6e81d9ae00d8c0e44f4b6c22008f433f class="flex justify-between"><a href=/en/privacy/>Privacy</a></label><ul><li><a href=/en/privacy/best-practices/>Bitcoin Privacy: Best Practices</a></li><li><a href=/en/privacy/no-kyc/>no-KYC only. Avoid the creep</a></li><li><a href=/en/wiki-bitcoin-privacy/>Bitcoin Privacy</a></li><li><a href=/en/bitcoin-becomes-critical/>Bitcoin Becomes Critical</a></li><li><a href=/en/bip47-the-ugly-duckling/>BIP47, the ugly duckling</a></li><li><input type=checkbox id=section-fa948e4e97baac946689641ce96c1e94 class=toggle>
<label for=section-fa948e4e97baac946689641ce96c1e94 class="flex justify-between"><a href=/en/privacy/oxt/>Understanding Bitcoin Privacy with OXT</a></label><ul><li><a href=/en/privacy/oxt-1/>Part 1: Chain Analysis And Transaction Privacy</a></li><li><a href=/en/privacy/oxt-2/>Part 2: Chain Analysis Core Concepts</a></li><li><a href=/en/privacy/oxt-3/>Part 3: Defences Against Chain Analysis</a></li><li><a href=/en/privacy/oxt-4/>Part 4: Applying Chain Analysis Concepts To Improve User Privacy</a></li></ul></li><li><a href=/en/privacy/coinjoin/>CoinJoin Overview</a></li><li><a href=/en/bitcoin-fungibility/>Bitcoin Fungibility</a></li><li><a href=/en/freesamourai/>#FreeSamourai</a></li></ul></li><li><input type=checkbox id=section-7703f58e8cfca24f7e8f10e99f7fd772 class=toggle>
<label for=section-7703f58e8cfca24f7e8f10e99f7fd772 class="flex justify-between"><a href=/en/protocol/>Protocol</a></label><ul><li><a href=/en/who-controls-bitcoin-core/>Who Controls Bitcoin Core?</a></li><li><a href=/en/bitcoins-eternal-struggle/>Bitcoin's Eternal Struggle</a></li><li><a href=/en/on-bitcoins-ux/>On Bitcoin’s UX</a></li><li><a href=/en/bitcoin-digital-gold-or-ecash/>Bitcoin: Digital Gold or Peer-to-Peer Cash?</a></li><li><a href=/en/bitcoin-governance/>Bitcoin Governance</a></li><li><a href=/en/trusted-third-parties/>Trusted Third Parties are Security Holes</a></li><li><a href=/en/21-million-is-non-negotiable/>21 Million is Non-Negotiable</a></li><li><a href=/en/proof-of-work/>Proof of Work, a pictorial essay</a></li><li><a href=/en/proof-of-stake-is-a-scam/>Proof of stake is a scam</a></li><li><a href=/en/was-satoshi-a-greedy-miner/>Was Satoshi a Greedy Miner?</a></li><li><a href=/en/segwit/>What Is SegWit</a></li><li><a href=/en/taproot/>What Is Taproot</a></li><li><a href=/en/coercion-of-ethereums-difficulty-bomb/>The Coercion Of Ethereum's Difficulty Bomb</a></li><li><a href=/en/rgb/>Understanding the RGB protocol</a></li><li><a href=/en/difficulty/>Bitcoin Difficulty Adjustment</a></li><li><a href=/en/bitcoin-address-types/>Bitcoin address types</a></li><li><a href=/en/myths-about-halving/>Myths About the Bitcoin Halving</a></li><li><a href=/en/mining-walkthrough/>SHA256 and Bitcoin Mining Walkthrough</a></li><li><input type=checkbox id=section-f1564ca04cb3a2764bdfe28910075cd7 class=toggle>
<label for=section-f1564ca04cb3a2764bdfe28910075cd7 class="flex justify-between"><a href=/en/protocol/utxo/>What Is UTXO And How To Manage Them</a></label><ul><li><a href=/en/protocol/utxo-1/>What is a Bitcoin UTXO</a></li><li><a href=/en/protocol/utxo-2/>Too Many UTXOs: How To Avoid High Fees</a></li><li><a href=/en/protocol/utxo-3/>UTXOs Privacy</a></li></ul></li><li><a href=/en/transaction-size/>Transaction Size</a></li><li><a href=/en/on-ossification/>On Ossification</a></li></ul></li><li><input type=checkbox id=section-3b225c8aaa13f68b831829121e8a96ea class=toggle>
<label for=section-3b225c8aaa13f68b831829121e8a96ea class="flex justify-between"><a href=/en/history/>History</a></label><ul><li><input type=checkbox id=section-6a04f6b3dd7c2dea74ad7a9a3b27156f class=toggle>
<label for=section-6a04f6b3dd7c2dea74ad7a9a3b27156f class="flex justify-between"><a href=/en/gf/>The Genesis Files</a></label><ul><li><a href=/en/gf/genesis-intro/>Intro</a></li><li><a href=/en/gf/genesis-1/>Part I: How David Chaum’s eCash Spawned a Cypherpunk Dream</a></li><li><a href=/en/gf/genesis-2/>Part II: Hashcash or How Adam Back Designed Bitcoin’s Motor Block</a></li><li><a href=/en/gf/genesis-3/>Part III: If Bitcoin Had a First Draft, Wei Dai’s B-Money Was It</a></li><li><a href=/en/gf/genesis-4/>Part IV: With Bit Gold, Szabo Was Inches Away From Inventing Bitcoin</a></li><li><a href=/en/gf/genesis-5/>Part V: How Hal Finney’s Quest For Digital Cash Led To RPOW (And More)</a></li></ul></li><li><a href=/en/hal-finney/>Hal Finney — The Life And Death Of A Cypherpunk Legend</a></li><li><a href=/en/bitcoin-and-me/>Bitcoin and Me</a></li><li><a href=/en/bitcoin-reformation/>The Bitcoin Reformation</a></li><li><a href=/en/bitcoin-forks/>A complete history of Bitcoin’s consensus forks</a></li><li><a href=/en/analyzing-2013-fork/>Analyzing the 2013 Bitcoin fork</a></li></ul></li><li><input type=checkbox id=section-8deaa51eea3af90eb190b70b9511c351 class=toggle>
<label for=section-8deaa51eea3af90eb190b70b9511c351 class="flex justify-between"><a href=/en/philosophy/>Philosophy</a></label><ul><li><input type=checkbox id=section-c0de4237ba1d1d542c91bf085525457d class=toggle>
<label for=section-c0de4237ba1d1d542c91bf085525457d class="flex justify-between"><a href=/en/what-i-learned-from-bitcoin/>What I've Learned From Bitcoin</a></label><ul><li><a href=/en/what-i-learned-from-bitcoin-1/>Part I. Philosophical Teachings of Bitcoin</a></li><li><a href=/en/what-i-learned-from-bitcoin-2/>Part II. Economic Teachings of Bitcoin</a></li><li><a href=/en/what-i-learned-from-bitcoin-3/>Part III. Technological Teachings of Bitcoin</a></li></ul></li><li><a href=/en/not-shitcoin/>Why Bitcoin, Not Shitcoin</a></li><li><a href=/en/inalienable-property-rights/>Inalienable Property Rights</a></li><li><a href=/en/crypto-anarchist-manifesto/>The Crypto Anarchist Manifesto</a></li><li><a href=/en/cypherpunks-manifesto/>A Cypherpunk's Manifesto</a></li><li><a href=/en/dutch-tulip-bubble/>Is Bitcoin Like the Dutch Tulip Bubble?</a></li><li><a href=/en/everyones-a-scammer/>Everyone's a Scammer</a></li><li><a href=/en/freedom-of-value/>The Freedom of Value</a></li><li><a href=/en/bitcoin-meme/>Bitcoin Is The Only Real Meme</a></li><li><a href=/en/number-zero-and-bitcoin/>The Number Zero and Bitcoin</a></li><li><a href=/en/crypto-bro/>Dear Crypto & Fiat Bros</a></li><li><a href=/en/fighting-fake-bitcoin/>Fighting Fake Bitcoin</a></li><li><a href=/en/bitcoin-is-the-mycelium/>Bitcoin is The Mycelium of Money</a></li><li><a href=/en/proof-of-life/>Proof of Life. Why Bitcoin is a Living Organism</a></li><li><a href=/en/most-peaceful-revolution/>A Most Peaceful Revolution</a></li><li><a href=/en/bitcoin-universe/>Bitcoin Universe</a></li><li><a href=/en/bitcoin-dissidents/>Bitcoin Dissidents</a></li><li><a href=/en/bitcoin-equals-freedom/>Bitcoin Equals Freedom</a></li></ul></li><li><input type=checkbox id=section-acee29309cd01b51e216d2d768d75871 class=toggle>
<label for=section-acee29309cd01b51e216d2d768d75871 class="flex justify-between"><a href=/en/future/>Future</a></label><ul><li><input type=checkbox id=section-8b8bdf99eb0d858d5adbfb2d713a72dc class=toggle>
<label for=section-8b8bdf99eb0d858d5adbfb2d713a72dc class="flex justify-between"><a href=/en/ba/>Bitcoin Astronomy</a></label><ul><li><a href=/en/ba/1/>Part I</a></li><li><a href=/en/ba/2/>Part II</a></li><li><a href=/en/ba/3/>Part III</a></li></ul></li><li><a href=/en/hey-bitcoin-slow-down/>Hey Bitcoin, Slow Down!</a></li><li><a href=/en/apocalypse/>Can Bitcoin Survive An Apocalypse?</a></li><li><a href=/en/bitcoin-and-oceans/>Bitcoin and Ocean Thermal Energy</a></li></ul></li><li><input type=checkbox id=section-7273d708b600eaa6617c228cdd2d9524 class=toggle>
<label for=section-7273d708b600eaa6617c228cdd2d9524 class="flex justify-between"><a href=/en/lightning/>Lightning</a></label><ul><li><a href=/en/what-is-lightning-network/>What is Lightning Network?</a></li><li><a href=/en/lightning-wallets/>Lightning Wallets</a></li><li><a href=/en/how-lightning-address-works/>How Lightning Address Works</a></li><li><a href=/en/lightning-network-privacy/>Lightning Network Privacy</a></li><li><a href=/en/is-lightning-centralized/>Is Lightning centralized?</a></li><li><a href=/en/lightning-network-explained/>Lightning Network Explained</a></li><li><a href=/en/inbound-liquidity-problem/>Solutions to inbound liquidity problem</a></li></ul></li></ul></li><li><input type=checkbox id=section-ebedd809137a39943c3339b07b86856f class=toggle checked>
<label for=section-ebedd809137a39943c3339b07b86856f class="flex justify-between"><a href=/en/practice/>Practice</a></label><ul><li><input type=checkbox id=section-a04618d8af5c321dea142dada821f01f class=toggle>
<label for=section-a04618d8af5c321dea142dada821f01f class="flex justify-between"><a href=/en/practice/buy/>Buy</a></label><ul><li><a href=/en/newbie-buy/>Buy and Hodl Bitcoin for Beginners</a></li><li><a href=/en/hodl-hodl/>Buy noKYC Bitcoin with HodlHodl</a></li><li><a href=/en/robosats/>RoboSats: Private P2P Exchange</a></li></ul></li><li><input type=checkbox id=section-52e946c82575a11d29d8ca1021a1b878 class=toggle>
<label for=section-52e946c82575a11d29d8ca1021a1b878 class="flex justify-between"><a href=/en/practice/hodl/>Hodl</a></label><ul><li><a href=/en/electrum/>Electrum Bitcoin Wallet</a></li><li><a href=/en/blue/>Installing Blue Wallet</a></li><li><a href=/en/seedsigner/>SeedSigner: DIY Bitcoin Signing Device</a></li><li><a href=/en/coldcard/>What is Coldcard?</a></li></ul></li><li><input type=checkbox id=section-7778724fd028202526d77fda64e80716 class=toggle>
<label for=section-7778724fd028202526d77fda64e80716 class="flex justify-between"><a href=/en/practice/interact/>Interact</a></label><ul><li><a href=/en/practice/bitcoin-node/>Why You Should Run Your Own Bitcoin Node</a></li><li><a href=/en/orangepilling-in-5-min/>Orangepilling in 5 min</a></li><li><a href=/en/5-tips-for-teaching-bitcoin/>5 tips for teaching Bitcoin</a></li></ul></li><li><input type=checkbox id=section-42375023512d85163c1ed33595577cc3 class=toggle>
<label for=section-42375023512d85163c1ed33595577cc3 class="flex justify-between"><a href=/en/practice-privacy/>Privacy</a></label><ul><li><input type=checkbox id=section-489729314822a64eb481d2971b819168 class=toggle>
<label for=section-489729314822a64eb481d2971b819168 class="flex justify-between"><a href=/en/practice-privacy/dojo/>Dojo x86 Bitcoin Node Guide</a></label><ul><li><a href=/en/practice-privacy/dojo-0/>Introduction</a></li><li><a href=/en/practice-privacy/dojo-1/>Installing Bitcoin Core & Tor</a></li><li><a href=/en/practice-privacy/dojo-2/>Installing Fulcrum Indexer</a></li><li><a href=/en/practice-privacy/dojo-3/>Installing Mempool Explorer</a></li><li><a href=/en/practice-privacy/dojo-4/>Installing Samourai Dojo</a></li><li><a href=/en/practice-privacy/dojo-5/>Firewall Configuration</a></li><li><a href=/en/practice-privacy/dojo-6/>Installing Package Updates</a></li></ul></li><li><a href=/en/practice-privacy/ronindojo/>RoninDojo x86 Installation Guide</a></li><li><a href=/en/grapheneos/>GrapheneOS: De-Google your phone</a></li></ul></li><li><input type=checkbox id=section-1ee5fbef80ad0a274c597a531c90648c class=toggle checked>
<label for=section-1ee5fbef80ad0a274c597a531c90648c class="flex justify-between"><a href=/en/practice/lightning/>Lightning</a></label><ul><li><a href=/en/phoenix/>Phoenix: The Non-Custodial Lightning Wallet</a></li><li><a href=/en/lnbits/>LNbits: A Swiss knife among Lightning apps</a></li><li><a href=/en/alby-and-nostr/>Alby and Nostr</a></li><li><a href=/en/zapplanner/>Recurring Lightning Payments</a></li><li><a href=/en/lntips/>Telegram bot @LightningTipBot</a></li><li><a href=/en/lightning-liquidity-management-guide/ class=active>Lightning Liquidity Management Guide</a></li><li><a href=/en/mutiny/>Starting with Mutiny Wallet</a></li></ul></li></ul></li><li><input type=checkbox id=section-0fbeb231f88c8b74f36060fd3f3377c6 class=toggle>
<label for=section-0fbeb231f88c8b74f36060fd3f3377c6 class="flex justify-between"><a href=/en/rabbithole/>Rabbithole</a></label><ul></ul></li></ul><div class=menuSep></div><ul><li><input type=checkbox id=section-5c8dd08fbf75826bbf8b24f27b15430e class=toggle>
<label for=section-5c8dd08fbf75826bbf8b24f27b15430e class="flex justify-between"><a href=/en/contribute/>Contribute</a></label><ul><li><a href=/en/github/>Adding an Article</a></li></ul></li><li><span>Blog</span></li><li><a href=/en/feedback/>Feedback</a></li></ul><div class=menuBlock><div id=metrics-container class=metrics-container><div id=metrics-label></div><div id=metrics-value></div></div></div></nav><footer><br><a class=menuSocialButton href=https://t.me/bitcoin21ideas target=_blank title=Telegram><svg viewBox="0 0 25 25"><path d="m12 0C5.373.0.0 5.373.0 12s5.373 12 12 12 12-5.373 12-12c0-6.627-5.373-12-12-12zm5.894 8.221-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002.0-.003.0-.005.0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121L8.32 13.617l-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/></svg>
</a>&nbsp;
<a class=menuSocialButton href=https://github.com/21ideas-org/21ideas.org target=_blank title=GitHub><svg viewBox="0 0 820 820"><path d="M4e2 9.9C179.11 9.9.0 189 0 409.94.0 585.6 113.24 734.86 270.71 788.61l2.83.83c20 3.76 27.34-8.59 27.34-19.24.0-9.49-.32-34.68-.5-68-111.27 24.14-134.75-53.68-134.75-53.68a106.58 106.58.0 00-44.09-58.26l-.43-.24c-36.23-24.81 2.8-24.3 2.8-24.3A84.06 84.06.0 01185 606.54l.22.4a85.24 85.24.0 00116.92 33l-.43.21A85.16 85.16.0 01327 586.7C238.19 576.67 144.8 542.25 144.8 389c0-.72.0-1.55.0-2.38a153.82 153.82.0 0141.27-105l-.08.11a139.82 139.82.0 01-8.56-48.58 141.91 141.91.0 0112.4-58.21l-.37.91s33.51-10.72 110 41c30-8.56 64.43-13.5 1e2-13.5a378.09 378.09.0 01102.68 14.14l-2.67-.64c76-51.72 109.51-41 109.51-41a144 144 0 0112 58.07 145.56 145.56.0 01-8.35 48.82l.32-1a154.37 154.37.0 0141 105c0 .83.0 1.63.0 2.43V389c0 153.68-93.5 187.51-182.52 197.35a95.48 95.48.0 0127.27 66.93c0 2.48-.11 5-.3 7.42v-.32c0 53.54-.51 96.54-.51 109.53.0 10.51 7 23 27.51 19C686.25 734.78 8e2 585.39 8e2 409.41 8e2 188.74 621.11 9.87 400.47 9.87H4e2z"/></svg>
</a>&nbsp;
<a class=menuSocialButton href=https://njump.me/npub1lm3f47nzyf0rjp6fsl4qlnkmzed4uj4h2gnf2vhe3l3mrj85vqks6z3c7l target=_blank title=Nostr><svg viewBox="0 0 820 820"><path d="M4e2 797.5c219.53.0 397.5-178 397.5-397.5S619.53 2.5 4e2 2.5 2.5 180.47 2.5 4e2 180.47 797.5 4e2 797.5zM598.23 242.15c6.82 8.46 10.35 18.14 11.45 28.86 1.7 16.37-2.68 31.17-11.2 45-14.19 23.62-43.17 39.63-45.85 41-5.42 2.86-7.42 7.12-7.06 13.34s-1.21 37.19-20 50.83c-9.68 7-48.64 16-66.6 19.05a28.61 28.61.0 00-13.18 5.37c-1 .67-2 1.36-3.2 2.06-6.82 4.27-31.23 38-35.31 45.48l10.66-3.27c21.2-6.53 66.85-20.6 69.52-21 9-1.4 15.89 1.22 20.34 7.79 3.63 5.41 7.18 10.81 10.75 16.25.61.94 1.23 1.87 1.85 2.81 1 1.54 2 3.08 2.93 4.62.48.78 1 1.55 1.45 2.32l1.52 2.38c.09.14.19.29.28.45a10.65 10.65.0 011.37 2.83c.24 1 .91 4.14-.92 6.09-1.7 1.77-4.63 1.77-6.21 1.34a15.65 15.65.0 01-5.6-2.8l-2.49-2.13c-2-1.71-5.73-2.56-8.71-2.44-3.41.13-8-1-10.11-2.37-4.2-2.74-5.35-9.56-5.35-9.68a3.51 3.51.0 00-3.72-2.86 18.58 18.58.0 00-6.28 1.15l-.78.25q-15 4.56-29.93 9.24h0l-14.31 4.45c-7.06 2.19-14.12 4.38-21.13 6.69a37.45 37.45.0 00-5.72 2.62c-.43.21-.84.43-1.25.64l-1.24.64h0c-.85.42-1.7.85-2.55 1.34l-.27.15a30.59 30.59.0 01-5.76 2.65c-7.12 2.13-13.39-1-16.32-8.1-1.88-4.63-.18-13.76.86-16.44 5.58-14.35 21.77-39.58 26.28-46.6.75-1.17 1.17-1.83 1.17-1.86-.36-.12-23.25 9.07-27 11.93-10.35 7.86-34.64 26.49-35 28.31A22.75 22.75.0 01331 508.13c-5.66 2.19-9.13 6.7-12.48 11.08.0.0-60.88 83.83-65 88.34l-.68.74c-2.83 3-12.28 13.16-15 18.13-.46.83-1.61 3.27-2.58 5.33-.6 1.26-1.13 2.38-1.38 2.89.0.05-.05.11-.08.17-.59 1.21-1.91 3.9-6.31 3.66s-4.79-6.12-5-9.09v-.4c-.54-6.88 1-13.7 4.63-20.82a6.46 6.46.0 01.31-.58c1-1.8 3.93-7 2.61-11.36s-2.61-11.14-.6-14.61c2.84-4.77 7.62-5.48 13.92-6.41l2.64-.41c5.29-.85 9.13-3.53 12.84-8.88 4.66-6.84 17-24.51 27.65-39.67C293.62 516 3e2 507 302.66 503.09a25.55 25.55.0 003.77-9.08c1.89-9.74 7.85-16.49 18.14-20.7 2.25-.85 43.17-35.06 43.17-39.45.0-3.1-4.45-4.87-7.92-5.78-.48-.12-26.24-6.82-37.92-12.12A88.58 88.58.0 01305 406.41c-7.53-5.54-22.23-3.16-25.3-2.67l-.27.05c-11 1.58-19.12 6.51-28.37 12.78-1.65 1.16-10.05 4.2-14.31 1.77-1.32-.75-2.9-1.6-4.65-2.54-9.16-4.92-22.91-12.31-28.59-20.9-3.11-4.69-2.68-12.42-.49-20.94 7.07-19.73 17.48-28.56 36.77-33.91 11.39-3.95 32.41-5.33 46.84-6.28 2.93-.19 5.59-.37 7.84-.54.12-.05.8-.09 1.94-.18 7-.51 31.32-2.27 49.13-11.39 1.61-.82 3.59-1.92 5.91-3.2 17.67-9.8 55.68-30.86 107.76-29.25 12.95.4 32.15 7.45 49.77 13.93 14.79 5.43 28.46 10.45 36.38 10.79 17.65.73 26.54-1.22 36.77-11.81 2.92-3.05 15.16-29.53 3.59-44a108.64 108.64.0 00-13.94-14.55q-2.28-1.94-4.59-3.85a183.79 183.79.0 01-15.8-14.29c-13.82-14.61-18.09-34.58-11.51-50.17 4.14-10.9 13-15.65 25.63-13.15 6.22 1.24 11.28 5.49 15.95 9.41a73.24 73.24.0 005.84 4.59c3.6 2.38 9.56 3.78 13.46 4.69 4.93 1.16 8.65 4.93 8.4 7.49s-6.7 4.75-13 4.26c-7.36-.49-20.09-.55-27.7 2-5.05 1.83-7.3 7.49-5.84 13 1.22 4.57 10.9 12.66 14.55 15.65 1.64 1.35 3.3 2.67 5 4C587.86 231.81 593.56 236.34 598.23 242.15z" fill-rule="evenodd"/></svg>
</a>&nbsp;
<a class=menuSocialButton href=/rss title=RSS><svg viewBox="-143 145 525 525"><path d="M113 145c-141.4.0-256 114.6-256 256s114.6 256 256 256 256-114.6 256-256S254.4 145 113 145zM43.1 518.7c-6.2 6.2-14.7 9.9-24.1 9.9-9.4.0-17.8-3.8-24-9.9-6.2-6.2-10-14.6-10-23.9.0-9.4 3.8-17.8 10-24s14.6-10 24-10 17.9 3.8 24 10c6.2 6.2 10 14.6 10 24C53 504.2 49.2 512.6 43.1 518.7zM104.8 529c-.1-32.1-12.5-62.3-35.1-84.9-22.6-22.6-52.8-35.2-84.7-35.2V360c46.6.0 88.7 19 119.3 49.6s49.5 72.8 49.6 119.4H104.8zm87.2.0c-.1-114.2-92.8-207.1-206.9-207.1V273c70.6.0 134.5 28.7 180.8 75.1 46.3 46.4 75 110.3 75.1 180.9H192z"/></svg>
</a>&nbsp;
<a class=menuSocialButton href=https://www.youtube.com/@21ideas target=_blank title=YouTube><svg viewBox="0 0 25 25"><path d="M12 0C5.373.0.0 5.373.0 12s5.373 12 12 12 12-5.373 12-12S18.627.0 12 0zm4.441 16.892c-2.102.144-6.784.144-8.883.0C5.282 16.736 5.017 15.622 5 12c.017-3.629.285-4.736 2.558-4.892 2.099-.144 6.782-.144 8.883.0C18.718 7.264 18.982 8.378 19 12c-.018 3.629-.285 4.736-2.559 4.892zM10 9.658l4.917 2.338L10 14.342V9.658z"/></svg></a></footer><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class="book-page book-page-page"><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Lightning Liquidity Management Guide</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#your-mileage-may-vary>Your Mileage May Vary</a></li><li><a href=#a-plethora-of-variables>A Plethora of Variables</a></li><li><a href=#deciding-what-channels-to-open>Deciding What Channels to Open</a></li><li><a href=#saving-on-chain-channel-open-fees-via-batch-opens>Saving On-Chain Channel Open Fees via Batch Opens</a></li><li><a href=#opening-dual-funded-channels>Opening Dual Funded Channels</a></li><li><a href=#channel-rebalancing>Channel Rebalancing</a></li><li><a href=#channel-policy-management>Channel Policy Management</a></li><li><a href=#buying-inbound-liquidity>Buying Inbound Liquidity</a></li><li><a href=#lightning-loop>Lightning Loop</a></li><li><a href=#lightning-loops-node>Lightning Loop&rsquo;s Node</a></li><li><a href=#freeing-up-stranded-capital>Freeing up Stranded Capital</a></li></ul></li><li><a href=#results>Results</a><ul><li><a href=#other-considerations--random-thoughts>Other Considerations / Random Thoughts</a></li></ul></li><li><a href=#going-forward>Going Forward</a></li></ul></li></ul></nav></aside></header><div class=pageCover><picture><img src=/img/lln-263.jpg alt=Cover></picture></div><h1>Lightning Liquidity Management Guide</h1><div class=pageDate>August 7, 2021</div><article class=markdown><p>Lessons learned from running a routing node on the Lightning Network.</p><blockquote class="book-hint btc"><p>This article by <a href=https://twitter.com/lopp>Jameson Lopp</a> was published in his <a href=https://blog.lopp.net/lightning-network-liquidity-management-guide>blog</a>.</p><p><a href=/contribute/>Contribute</a>.</p></blockquote><p>Ever since people started running Lightning nodes on mainnet in early 2018, some have asked the question: what is a reasonable ROI to expect for placing my capital in a routing node? Nik Bhatia went in depth with his theory of how this may play out:</p><div class=imageWrapper><img src=/img/lln-264.jpeg><p><em><a href=https://timevalueofbtc.medium.com/the-time-value-of-bitcoin-and-lnrr-e0c435931bd8>The Time Value of Bitcoin and LNRR</a></em></p></div><p>But as we&rsquo;ve learned over the years, there&rsquo;s far more to ROI than simply putting capital into Lightning channels.</p><blockquote class=twitter-tweet><p lang=en dir=ltr>Lightning routing is a multi-faceted competitive system. It’s not just about capital, a brute force deployment of capital will cripple ROI. The system models a distributed predictive cache. Available capital is a factor but so is intelligent capital placement, reliability, speed.</p>&mdash; Alex Bosworth (@alexbosworth) <a href="https://twitter.com/alexbosworth/status/994603452310278144?ref_src=twsrc%5Etfw">May 10, 2018</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>In early 2021 I decided to set forth to try to determine how well I could do running a node with the goal of earning a profit by routing funds.</p><blockquote class=twitter-tweet><p lang=en dir=ltr>If you're asking what is the ROI on a routing node, you're operating from an incorrect premise of how Lightning functions<br><br>A billion dollars can flow over a $5 channel. Managing to place and maintain that channel where a billion dollars needs to flow is the really difficult part.</p>&mdash; Alex Bosworth (@alexbosworth) <a href="https://twitter.com/alexbosworth/status/1358807809631035395?ref_src=twsrc%5Etfw">February 8, 2021</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>I followed the process described in my earlier post to set up my tor-only node:</p><div class=imageWrapper><img src=/img/lln-265.png><p><em><a href=https://blog.lopp.net/tor-only-bitcoin-lightning-guide>Tor-Only Bitcoin & Lightning Guide</a></em></p></div><p>Getting the software running was the easy part. Next I had to figure out how to place my capital most effectively.</p><h3 id=your-mileage-may-vary>Your Mileage May Vary
<a class=anchor href=#your-mileage-may-vary>#</a></h3><p>Unfortunately it&rsquo;s not possible to write a guide that simply says &ldquo;connect to these nodes and start earning fees.&rdquo; You have to think of the Lightning Network as a competitive market for offering efficient flow of capital. Much like with a given trading strategy, if everyone started to use the same strategy, any advantages the strategy had will disappear and it would create opportunities for others to trade against it. If everyone builds the same bridges for capital flows, it would be a race to the bottom to compete over fees and it would be smarter for other operators to &ldquo;counter trade&rdquo; that strategy by building bridges elsewhere.</p><h3 id=a-plethora-of-variables>A Plethora of Variables
<a class=anchor href=#a-plethora-of-variables>#</a></h3><p>You may have noticed that this is an extremely lengthy article. That&rsquo;s because there are many different issues one needs to consider when operating a Lightning Network node with the goal of maximizing routing. This includes:</p><ul><li>Capital Placement</li><li>Routing Fees</li><li>Minimizing on-chain fees</li><li>Your Total Inbound / Outbound Capacity</li><li>Maintaining Routing Capacity (Rebalancing / Submarine Swaps)</li><li>Inbound / Outbound Capacity of Peers</li><li>Peer Responsiveness / Uptime / Health</li><li>Your Node&rsquo;s Responsiveness / Load / Network Connectivity</li></ul><h3 id=deciding-what-channels-to-open>Deciding What Channels to Open
<a class=anchor href=#deciding-what-channels-to-open>#</a></h3><p>Alex Bosworth has some detailed guidance <a href=https://github.com/alexbosworth/run-lnd/blob/master/LIQUIDITY.md>in this document</a>.</p><p>It&rsquo;s simple to open Lightning channels - the vast majority of nodes on the network will accept almost any value of incoming channel. As such, it&rsquo;s easy to lock up capital with a poorly performing peer who does not route many payments. And if your peer becomes unresponsive, an uncooperative channel close can put your capital in limbo for weeks.</p><p>In my initial experimentation I found that some peers were simply unroutable, perhaps because they didn&rsquo;t have enough liquidity going to other peers. It&rsquo;s pretty hard to tell what a peer&rsquo;s status will be without probing different routes through them, which requires opening a channel first. I do expect we will see services coming online to help address this issue and offer more insight regarding the liquidity status of a given node.</p><p>Whatever you do, <strong>avoid using lnd&rsquo;s autopilot</strong>; it just connects to large popular nodes. Similarly, it seems like a lot of folks are just going to Lightning Terminal or 1ML and connecting to the highest ranked nodes. It may be counterintuitive, but this is not a winning strategy if you want your node to route a lot of payments. Rather, you should <strong>seek to create new bridges</strong> by tying together peers that otherwise would have to take many hops to route to each other.</p><p>Another issue I&rsquo;ve seen is folks using the BOS score to decide what nodes with which to open channels. Alex Bosworth, who wrote that scoring algorithm, has told me that it wasn’t designed as a routing node matching system / quality score.</p><p>I used the <a href=https://moneni.com/nodematch>node match tool</a> to figure out which nodes would increase my connectivity the most. However, I&rsquo;d once again caution against blindly opening channels to the ones ranked the highest. Before opening a channel with one of the recommended nodes, I check it on <a href=https://terminal.lightning.engineering/>Lightning Terminal</a> to see if it&rsquo;s stable. Then I check it on <a href=https://1ml.com/>1ML</a> to see if they are setting sane fee policies.</p><div class=imageWrapper><img src=/img/lln-266.png></div><p>To get another perspective on how to increase my node&rsquo;s centrality, I used Gridflare&rsquo;s <a href=https://github.com/Gridflare/lndpytools/blob/main/improvecentrality.py>&ldquo;improve centrality&rdquo; script</a> from <a href=https://github.com/Gridflare/lndpytools>lndpytools</a>. This is certainly not as user friendly as other web based tools as it requires getting a full network graph dump from your node, transferring it to your desktop / laptop, and then running the analysis on that json file.</p><div class=imageWrapper><img src=/img/lln-267.png></div><p>In my experience, most of the &ldquo;highly connected&rdquo; nodes with 500+ channels tend to be unstable and thus don&rsquo;t route many payments. I suspect that they are putting too much strain on their hardware. However, others have reported a different experience - YMMV!</p><p>If you can afford it, don&rsquo;t create channels of &lt; 10M sats. Keep in mind that the default max payment size is a little over 4M sats. So if you want to be able to maintain channels that can route the max payment size in either direction, you need at least double that - preferably more since it&rsquo;s pretty hard to have both enough inbound liquidity and enough outbound liquidity on both sides of the channel. If you&rsquo;re not trying to be a routing node, this doesn&rsquo;t matter as much. It&rsquo;s possible to be a high volume routing node for smaller payments with smaller channels - you&rsquo;ll likely need to do more rebalancing - but it&rsquo;s still desirable for your channel&rsquo;s capacity to be as high as possible.</p><p>If you can&rsquo;t afford 10M sats channels then I&rsquo;d still suggest a <strong>minimum of 1M sats</strong>. My node has forwarded 400 payments over the past few months and the average amount forwarded was 420,000 sats - about $150. thus you&rsquo;d need a nearly perfectly balanced 1M sat channel in order to be able to forward a single average payment. Hopefully the dynamics will change as more and more wallets start using multi-path payments.</p><p>In lnd you can prevent inbound channels below a certain size by setting this in lnd.conf:</p><pre tabindex=0><code>minchansize=1000000
</code></pre><p>Not all nodes will allow you to open a channel with them, and they won&rsquo;t explain why they reject your channel request. For example, I tried to open a channel with a Zap node and got rejected even when I tried the max (default) channel size.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ lncli openchannel --node_key 
</span></span><span style=display:flex><span>03b428ba4b48b524f1fa929203ddc2f0971c2077c2b89bb5b22fd83ed82ac2f7e1 --local_amt <span style=color:#ae81ff>16000000</span> --sat_per_vbyte <span style=color:#ae81ff>1</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>lncli<span style=color:#f92672>]</span> rpc error: code <span style=color:#f92672>=</span> Unknown desc <span style=color:#f92672>=</span> received funding error from 03b428ba4b48b524f1fa929203ddc2f0971c2077c2b89bb5b22fd83ed82ac2f7e1: err<span style=color:#f92672>=</span>channel rejected
</span></span></code></pre></div><p>Before opening a channel you should try to determine what the routing policy of the counterparty will be. For example, LNBIG has pretty high fees of 175ppm - what&rsquo;s the point of paying for inbound liquidity to your node if folks will avoid using it due to high fees?</p><p>Some nodes have absurdly high routing fees; for example I noticed that both OKEX and OKCoin&rsquo;s nodes have their base fee set to 1M satoshis - $400! I actually spoke to OKCoin&rsquo;s CEO about this and they said it was done by design to discourage routing; I suggested they change their configs to simply reject inbound channel opens.</p><h3 id=saving-on-chain-channel-open-fees-via-batch-opens>Saving On-Chain Channel Open Fees via Batch Opens
<a class=anchor href=#saving-on-chain-channel-open-fees-via-batch-opens>#</a></h3><p>If you&rsquo;re starting up a fresh node for which you need to open many channels, and you&rsquo;re comfortable on the command line, consider batching your channel opens with the following method.</p><p><em>Batch open transaction with balanceofsatoshi and Electrum Desktop. Below is a quick description of the process, but this step involves an onchain transaction and therefore possible loss of funds if you make a mistake. There is a detailed tutorial on Jestopher&rsquo;s website: <a href=http://satbase.org/bos-open/>http://satbase.org/bos-open/</a>.</em></p><ol><li><p>In Electrum Desktop, go to Tools > Preferences, under the &lsquo;Transactions&rsquo; tab, activate &lsquo;Advance preview&rsquo;. Then in Tools, open the &lsquo;Pay to many&rsquo; dialog box.</p></li><li><p>On your node, as a bos user, in the command line interface, enter this command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bos open &lt;node pubkey 1&gt; --amount &lt;channel size in sats 1&gt; &lt;pubkey 2&gt; --amount &lt;channel size 2&gt; &lt;pubkey 3&gt; --amount &lt;channel size 3&gt; &lt;pubkey 4&gt; --amount &lt;channel size 4&gt; &lt;pubkey 5&gt; --amount &lt;channel size 5&gt; &lt;pubkey 6&gt; --amount &lt;channel size 6&gt;
</span></span></code></pre></div><p>After pressing enter, a 10 min counter will start, and you will need to do steps 3 to 5 within the 10 mins. Make sure to not use Ctrl+C once the timer has started! If you want to cancel the process and timer, just press Enter in the command line interface.</p></li><li><p>Do not enter any other command in the CLI, but just copy the output of the &lsquo;bos open&rsquo; command, which will be a list of onchain addresses and amount in bitcoin separated by a comma. This is a format compatible with Electrum &lsquo;pay to many&rsquo; option.</p></li><li><p>In Electrum, paste this list in the pay-to-many dialog box, save the transaction, click &lsquo;Pay&rsquo;, set a fixed fee as low as possible based upon the current conditions of the <a href=https://mempool.space/>mempool</a>. Make sure that RBF is NOT checked. Then click &lsquo;Finalize&rsquo; and &lsquo;Sign&rsquo; it using your hardware wallet (or Electrum wallet if not using a hardware wallet) but <strong>DO NOT broadcast it!</strong> This will be done by balanceofsatoshi.</p></li><li><p>Once finalized and signed, copy the signed raw transaction and paste it in the command line interface and press &lsquo;Enter&rsquo;. After a few seconds or minutes, bos will display a transaction ID. You can then use your node&rsquo;s own block explorer to check the status of your batch transaction.</p></li></ol><h3 id=opening-dual-funded-channels>Opening Dual Funded Channels
<a class=anchor href=#opening-dual-funded-channels>#</a></h3><p>If you have a friend who will cooperate with you, you can save a bit on rebalancing / looping by initializing a channel that is already balanced. Here are the steps for Alice and Bob, using the bos CLI.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>(</span>NODE 1: Bob<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>0<span style=color:#f92672>)</span> Run: bos open-balanced-channel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>1<span style=color:#f92672>)</span> enter remote node public key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>2<span style=color:#f92672>)</span> enter full channel size
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>3<span style=color:#f92672>)</span> enter fee rate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Open a new terminal window.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>4<span style=color:#f92672>)</span> Run: bos fund --fee-rate &lt;fee&gt; &lt;address&gt; &lt;amount in sats&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Copy the signed_transaction and go back to 1st window and paste
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>5<span style=color:#f92672>)</span> paste the signed_transaction to bos prompt in 1st window  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>NODE 2: Alice<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>0<span style=color:#f92672>)</span> Run: bos open-balanced-channel <span style=color:#f92672>(</span>it should see the request from node1 at this point<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>1<span style=color:#f92672>)</span> agree with funding rate <span style=color:#f92672>(</span>y/n<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Open a new terminal window.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>2<span style=color:#f92672>)</span> Run: bos fund --fee-rate &lt;fee&gt; &lt;address&gt; &lt;amount&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Copy the signed_transaction and go back to 1st window and paste
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>3<span style=color:#f92672>)</span> paste the signed_transaction to bos prompt in 1st window
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>4<span style=color:#f92672>)</span> hit enter and this should work.  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>check via: lncli pendingchannels
</span></span></code></pre></div><h3 id=channel-rebalancing>Channel Rebalancing
<a class=anchor href=#channel-rebalancing>#</a></h3><p>In some cases I was never able to rebalance a channel due to insufficient liquidity. If you notice a channel can never be rebalanced and it never gets used to route funds, you may want to consider closing it and allocating that capital elsewhere.</p><p>You should make sure it makes economic sense before rebalancing channels. Otherwise you will just get caught in a loop of constantly rebalancing channels since they will rarely stay perfectly balanced. Blindly rebalancing in the hunt for maintaining perfect balance is almost assuredly going to end up costing you more in fees than you earn from routing payments. Thankfully &lsquo;bos&rsquo; has a &ndash;dryrun option to see what the fee will be.</p><p>You can use bos to auto rebalance but in order to ensure that you don&rsquo;t perform uneconomical rebalances is that you&rsquo;d want to set the max fee rate to your minimum fee rate / 2. You can achieve it by adding this line to /etc/crontab:</p><pre tabindex=0><code>*/10 * * * *     jameson /path/to/bos rebalance --max-fee-rate 5
</code></pre><p>Eventually I stumbled across Carsten Otto&rsquo;s <a href=https://github.com/C-Otto/rebalance-lnd>rebalance-lnd tool</a>. I like this tool for rebalancing because it goes an extra step into determining if a given rebalance route makes economic sense. How is economic viability of a rebalance calculated?</p><p>Let&rsquo;s say your node has two channels for which to evaluate a rebalance; one to Bitfinex with 10M sats on your side and a 1,000 ppm fee rate. Your node also has a channel to LOOP and charges 5,000 ppm to forward funds. Sadly, your side of the channel is mostly empty.</p><p>It might be a good idea to push funds from the Bitfinex channel to the LOOP channel. If you do that for a 4M sat rebalance, this would mean:</p><ol><li>After doing a rebalance there will be 6M sats left that can be pushed to Bitfinex. You won&rsquo;t be able to earn the 4M * 1,000 ppm = 4,000 sats for the funds you took out of the channel as part of the rebalance to LOOP. This is the opportunity cost you have paid.</li><li>You also have to pay whatever the rebalance transaction costs; this is your direct cost.</li><li>If you&rsquo;re lucky, you get to send those 4M sat to LOOP and earn 4M * 5,000 ppm = 20,000 sat. This is your potential future earnings.</li></ol><p>The rebalance transaction only makes economic sense if Potential Earnings - Opportunity Cost - Direct Cost > 0.</p><p>The frustrating thing I quickly discovered was&mldr; rebalancing usually isn&rsquo;t worth it. It seems that &lt; 5% of my attempted rebalances end up completing with this tool.</p><p>I set a cronjob to run a random rebalance every 5 minutes by adding this line to /etc/crontab:</p><pre tabindex=0><code>*/5 * * * *     jameson /path/to/rebalance.py --to -1
</code></pre><p>My node has a couple dozen channels but at any given time only about 25% of them are in need of rebalancing according to the rebalance-lnd tool, which defaults to trying to keep at least 1M sats on each side of a channel. These defaults are unlikely to be optimal for your own situation. By running a random rebalance attempt every 5 minutes I expect that each channel in need of rebalancing will be attempted twice an hour.</p><p><strong>Warning</strong>: <em>this can be costly if your channel fee rates are unrealistically high and you lower them in the future</em>! Make sure you understand the ramifications of automating actions that cost money.</p><p><strong>Pro Tip</strong>: I learned after running rebalances every 5 minutes for a week that it filled up various dashboards with tons of unpaid expired invoices. In order to mitigate this issue, I suggest setting the following two lnd configs:</p><pre tabindex=0><code>gc-canceled-invoices-on-startup=true  
gc-canceled-invoices-on-the-fly=true
</code></pre><h3 id=channel-policy-management>Channel Policy Management
<a class=anchor href=#channel-policy-management>#</a></h3><p>Eventually I came across <a href=https://github.com/accumulator/charge-lnd>charge-lnd</a> which is a tool to automatically dynamically change routing fees on my channels. It&rsquo;s worth noting that this is far from a perfect tool because unfortunately we can only set outbound fees for channels. This is a limitation of the Lightning protocol rather than the tool; you can read more about the debate over supporting inbound fees <a href=https://github.com/lightningnetwork/lightning-rfc/issues/835>on this github issue</a>.</p><p>Initially for the first few months of operation I set all of my channel fee policies to be:</p><pre tabindex=0><code>base_fee_msat: 5000  
fee_ppm: 2000
</code></pre><p>These fees are an order of magnitude higher than the defaults; I just wanted to see if users on the network would bite. However, my node only sporadically routed funds with these fee levels. Presumably either my fees were too high and/or my node was not positioned well in the network graph.</p><p>Later on I set the following config for charge-lnd:</p><pre tabindex=0><code>[proportional]  
chan.min_ratio = 0  
chan.max_ratio = 1  
strategy = proportional  
base_fee_msat = 1000  
min_fee_ppm = 10  
max_fee_ppm = 2000
</code></pre><p>And set a cronjob to run charge-lnd hourly by adding this line to /etc/crontab:</p><pre tabindex=0><code>0 * * * *     jameson /path/to/charge-lnd -c /path/to/charge.config
</code></pre><p>Within 48 hours after enabling this dynamic policy management, I saw my node start routing more payments.</p><p>You shouldn&rsquo;t run this script more frequently than once an hour since these updates propagate relatively slowly (1 minute per hop) and if you change fees too often, the remote nodes that decide to route through you would often get <code>FEE_INSUFFICIENT</code> errors and probably blacklist your channels or node for hours. It&rsquo;s also desireable to reduce gossip traffic on the network.</p><p>After a couple months I still was only seeing sporadic routing so I changed my fee values to:</p><pre tabindex=0><code>min_fee_ppm = 2  
max_fee_ppm = 200
</code></pre><p>One thing worth noting is that using dynamic channel policy manager somewhat conflicts with the logic used by the rebalance-lnd tool - it assumes that your channel fees will remain the same for the forseeable future when it calculates the opportunity cost you&rsquo;re paying by moving liquidity around. For example, if rebalance -lnd is using the current fee rate of your channel to decide when to rebalance, but charge lnd is changing the fee rates around, rebalance lnd would make a decision that makes sense to it at fee rate A but then charge lnd could come along later and change to fee rate B, invalidating the logic of rebalance lnd for fee rate A. It seems like rebalance-lnd would need to also know the charge lnd config and the historical flow of funds across the channel in order to better predict future fee revenue.</p><h3 id=buying-inbound-liquidity>Buying Inbound Liquidity
<a class=anchor href=#buying-inbound-liquidity>#</a></h3><p>Gaining (and maintaining) inbound liquidity is one of the biggest challenges to running a routing node.</p><p>As of July 5, 2021 the cost to purchase a max amount of inbound liquidity (16.7M sats / $5,650) for a channel via certain services is:</p><ul><li><a href=https://www.bitrefill.com/buy/lightning-channel/>Bitrefill</a>: 199,021 sats / $67</li><li><a href=https://yalls.org/about/>Y&rsquo;alls</a>: 150,000 sats / $50.44</li><li><a href=https://lnbig.com/#/open-channel>LNBIG</a>: 24,101 sats / $8.30</li><li><a href=https://github.com/lightninglabs/loop>Loop</a>: 26,165 sats / $8.81</li><li><a href=https://github.com/lightninglabs/pool>Pool</a>: unknown (auctions are blind)</li></ul><p>You can also use these services to open a channel and either have a reciprocated channel opened back to your or have funds returned on-chain:</p><ul><li><a href=https://lightningconductor.net/channels>https://lightningconductor.net/channels</a></li><li><a href=https://ln2me.com/>https://ln2me.com/</a></li></ul><p>Those methods require trusting the service to return funds. A solution that requires less trust is to use the bos dual-funded channel open functionality referenced earlier, though this requires you to find a channel counterparty who is savvy enough to use the balanceofsatoshis CLI.</p><p>If you happen to have an account on an exchange that supports Lightning deposits, you can send to the exchange and then perform an on-chain withdrawal, thus increasing your inbound capacity. <a href="https://www.youtube.com/watch?v=HtU7ZlxvLL4&amp;feature=youtu.be&amp;t=273">I gave a presentation</a> years ago about the importance of onboarding exchanges to the Lightning Network to improve liquidity.</p><p>Finally, you can use a variety of communication channels to coordinate liquidity swaps.</p><ul><li><a href=https://lightningnetwork.plus/>https://lightningnetwork.plus/</a></li><li><a href="https://www.reddit.com/r/TheLightningNetwork/search?sort=new&amp;restrict_sr=on&amp;q=flair%3ALiquidity%2BSwaps">Reddit Lightning Triangles</a></li><li><a href=https://t.me/theRingsOfFire>Rings of Fire</a></li><li><a href=https://t.me/Plebnet>Plebnet</a></li></ul><p>If you&rsquo;re a balanceofsatoshis user, bos makes loop outs easy via</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bos increase-inbound-liquidity --amount &lt;sats&gt; --with &lt;pubkey&gt;
</span></span></code></pre></div><p>Be aware that one of these swaps will generally take an hour to complete.</p><p>However, it&rsquo;s worth noting that there are no guarantees when it comes to inbound liquidity. Channel counterparties can always close the channel if they decide their capital is not well-allocated!</p><p>The one exception is <a href=https://lightning.engineering/pool/>Lightning Pool</a> in which you are entering into a contract to purchase liquidity for a certain length of time and this duration is actually enforced at the blockchain level. Per the <a href=https://github.com/lightninglabs/pool-paper/blob/main/liquidity.pdf>whitepaper</a>:</p><div class=imageWrapper><img src=/img/lln-268.png></div><p>Hopefully in the near future we&rsquo;ll also have native <a href=https://bitcoinops.org/en/newsletters/2021/07/28/#c-lightning-4639>liquidity advertisements</a> available at the protocol level.</p><h3 id=lightning-loop>Lightning Loop
<a class=anchor href=#lightning-loop>#</a></h3><p>I was hopeful that getting inbound liquidity via the <a href=https://github.com/lightninglabs/loop>Lightning Loop</a> service would be easier and safer than trusting various third party services. It was incredibly easy to set up loopd and use loop on the command line.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ./loop quote out -v <span style=color:#ae81ff>16777215</span>  
</span></span><span style=display:flex><span>Send off-chain: <span style=color:#ae81ff>16777215</span> sat  
</span></span><span style=display:flex><span>Receive on-chain: <span style=color:#ae81ff>16759995</span> sat  
</span></span><span style=display:flex><span>Estimated on-chain fee: <span style=color:#ae81ff>338</span> sat  
</span></span><span style=display:flex><span>Loop service fee: <span style=color:#ae81ff>16882</span> sat  
</span></span><span style=display:flex><span>Estimated total fee: <span style=color:#ae81ff>17220</span> sat  
</span></span><span style=display:flex><span>No show penalty <span style=color:#f92672>(</span>prepay<span style=color:#f92672>)</span>: <span style=color:#ae81ff>30000</span> sat
</span></span></code></pre></div><p>It looks like <a href=https://docs.lightning.engineering/lightning-network-tools/loop/autoloop>Autoloop</a> should also be fairly simple to set up, though I&rsquo;m not sure if it&rsquo;s really necessary for a routing node. I&rsquo;m hesitant to set up autolooping because most of the manual loops I attempt do not complete.</p><p>The tricky thing about doing loop outs to gain inbound liquidity is that</p><ol><li>you want to do it for a fairly large value so that the on-chain fees make it worthwhile yet</li><li>the larger the value you try to loop out, the more difficult it is to find a path to route the funds off-chain.</li></ol><p>The vast majority of my attempts to loop out larger amounts would fail due to lightning routing issues. For example, my node spun for 20 minutes trying to find a way to route 4M sats out of Blockstream&rsquo;s node. I suspect that they don&rsquo;t have much outbound liquidity; since it&rsquo;s a store most liquidity is probably pointed at it as a sink to receive payments.</p><h3 id=lightning-loops-node>Lightning Loop&rsquo;s Node
<a class=anchor href=#lightning-loops-node>#</a></h3><p>As a test I opened a channel with the <a href=https://amboss.space/node/021c97a90a411ff2b10dc2a8e32de2f29d2fa49d41bfbb52bd416e460db0747d0d>LOOP</a> node for which I paid 1 sat/b (154 sat).</p><p>Within a 5 hours, 11 payments had been forwarded through that channel and had consumed 98% of my outbound capacity to LOOP. I earned a bit over 3,000 satoshis in fees.</p><p>The LOOP node then closed my channel at 2.5 sat/b (244 sat) - presumably because it was so unbalanced it was unusable for the loop server to receive more funds. From what I&rsquo;ve heard, they have an auto close when your local balance is at 20% or below. 2,600 sats worth of profit sounds pretty good, right?</p><p>LOOP appears to churn through a ton of channels; of the 48 channels open at time of writing, the average age is 16 days old and it seems to close 5% to 10% of its open channels every day.</p><p>Next I tried opening a large channel with LOOP for which I set a really high fee rate of 1% to see if anyone would bite.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lncli updatechanpolicy --base_fee_msat <span style=color:#ae81ff>5000</span> --fee_rate 0.01 --time_lock_delta <span style=color:#ae81ff>18</span> --chan_point &lt;UTXO&gt;
</span></span></code></pre></div><p>I also had to update my &ldquo;charge&rdquo; config so that it would ignore this channel and not automatically lower the fees back down.</p><pre tabindex=0><code>[loop]  
node.id = 021c97a90a411ff2b10dc2a8e32de2f29d2fa49d41bfbb52bd416e460db0747d0d  
strategy = ignore
</code></pre><p>After several days and not routing any payments, I cut the fee in half and noticed a trickle of payments being routed. I may try this experiment again later on with a wumbo channel.</p><p>However, Alex Bosworth pointed out that it won&rsquo;t be a simple rinse-and-repeat cycle of opening high value channels with LOOP. Why not? Because every time you do so, it is consuming your total inbound liquidity to the rest of the network via all of your other channels. So imagine if your node has a total of 10M sats of inbound liquidity and you open 1M sat channels with the LOOP node. You&rsquo;d only be able to repeat that ~10 times before you won&rsquo;t be able to route any more funds to the LOOP node with your latest channel.</p><p>After a fair amount of experimentation and failed loop outs, it appears that a winning strategy is to open a large channel with the LOOP node, set high routing fees on it so that it doesn&rsquo;t get drained, and then use the node to loop inbound liquidity cheaply because you won&rsquo;t have to pay routing fees.</p><h3 id=freeing-up-stranded-capital>Freeing up Stranded Capital
<a class=anchor href=#freeing-up-stranded-capital>#</a></h3><p>Some peers never routed funds because they were unstable, so I&rsquo;d close the channel to them because it seemed a waste of capital and route probing to keep them open. But if the peer was unresponsive when I went to close the channel, it would perform a force close that would keep the capital locked up for over a week.</p><p>There&rsquo;s not much point locking funds in channels if those funds don&rsquo;t get used. Thankfully bos also makes it fairly easy to figure out which peers to cull.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bos remove-peer --dryrun --idle-days <span style=color:#ae81ff>90</span> --fee-rate <span style=color:#ae81ff>5</span> --active
</span></span></code></pre></div><p>There&rsquo;s also the issue of peers that are offline too much in order for funds to be regularly routed.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bos remove-peer --dryrun --idle-days <span style=color:#ae81ff>30</span> --fee-rate <span style=color:#ae81ff>5</span> --offline
</span></span></code></pre></div><p>Since these operations require on-chain transactions I&rsquo;m going to put them in a cron job to run on the weekend when fees are lower.</p><p>However, if you&rsquo;re going to close out a channel you might as well try to use that capital to rebalance some of your other channels before doing so.</p><p>You&rsquo;ll also want to close out channels that aren&rsquo;t earning you much in routing fees:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bos peers --fee-days <span style=color:#ae81ff>60</span> --sort fee_earnings
</span></span></code></pre></div><p>The output from this command will also show you which channels are probably more worthwhile to rebalance (the ones generating lots of routing fees.)</p><h2 id=results>Results
<a class=anchor href=#results>#</a></h2><p>After I got my channels well balanced I waited a few weeks to see if I made much in fees.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ bos forwards --complete --days <span style=color:#ae81ff>90</span>
</span></span></code></pre></div><p>Across a dozen channels I had earned 17,025 satoshis in routing fees.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ bos chart-fees-earned
</span></span></code></pre></div><div class=imageWrapper><img src=/img/lln-269.png></div><p>However, I had spent 31,897 satoshis in on-chain fees.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ bos chart-chain-fees
</span></span></code></pre></div><div class=imageWrapper><img src=/img/lln-270.png></div><p>After another month or so of playing around with my node on the weekends, changing around dozens of channels, and adding automation:</p><div class=imageWrapper><img src=/img/lln-271.png></div><p>It&rsquo;s worth nothing that nearly half of the 60,000 satoshis in on-chain fees that were paid were <strong>due to a single force close of a channel</strong>. This force close paid over 100 satoshis per virtual byte in fees when it could have been confirmed quickly with ~5 satoshis per virtual byte. In hindsight I believe this could have been avoided if I had been patient and waited for that peer to come back online before closing the channel. <em>If not for that unforced error, I&rsquo;d likely have earned more in off-chain fees than I&rsquo;ve paid in on-chain fees as of today</em>. This appears to be a common issue.</p><div class=imageWrapper><img src=/img/twitter-c_otto83-1417545255319134213.png><p><em><a href=https://web.archive.org/web/20210720180145/https://twitter.com/c_otto83/status/1417545255319134213>Source</a></em></p></div><p>On the bright side, anchor channels should address this problem so that you don&rsquo;t have to rely on old and over-estimated fee rates. As of lnd 0.13.0 newly created channels use anchors by default; you just need to ensure you maintain ~100,000 sats in your on-chain wallet to use as a fee reserve.</p><p>In terms of off-chain fees, I am pleased to see that while my fees in ppm are lower now, I am routing transactions more consistently. My daily average for the past 90 days is 500 satoshis in fees collected while my average for the past 10 days is 1,000 satoshis collected.</p><p>While I&rsquo;m not a profitable routing node at time of writing, I see a light at the end of the tunnel and will continue my efforts of analyzing and adjusting my node.</p><h3 id=other-considerations--random-thoughts>Other Considerations / Random Thoughts
<a class=anchor href=#other-considerations--random-thoughts>#</a></h3><p>Prior to upgrading to lnd v0.13 my (tor-only) node was unable to connect to IPV4 nodes, which greatly limited my options for deploying capital. If you&rsquo;re running a tor-only node you should realize that you&rsquo;ll be at a disadvantage when it comes to getting inbound liquidity from nodes that aren&rsquo;t operating on tor.</p><blockquote class=twitter-tweet><p lang=en dir=ltr>Unpopular Truth<br>Tor unfortunately makes LN too unreliable. During the best of times it causes routing to go a lot slower. During the worst of times routing stops working entirely. RPC ping with larger data reveals the response time stretching into tens of seconds which breaks LN.</p>&mdash; Warren Togami (@wtogami) <a href="https://twitter.com/wtogami/status/1405785148298338308?ref_src=twsrc%5Etfw">June 18, 2021</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>As an operator you should not focus only on individual channel balances but also on your node&rsquo;s overall inbound/outbound liquidity ratio. For example, if you have 100M sats in outbound liquidity but only 10M sats inbound, much of that outbound liquidity is useless. Getting inbound liquidity is one of the biggest challenges in my experience, even after performing a lot of loop outs.</p><p>Lightning Terminal Web&rsquo;s algorithm is proprietary; hard to say how much stock you should put into it. Also, it will consider your node unstable if it doesn&rsquo;t have 3 nines of uptime (99.9%) - from this standpoint, <strong>running a routing node from a residential internet connection may not be a great idea without good backups</strong>. Anecdotally, I noticed I had reliability problems with some random folks I peered with from telegram groups who were running their nodes on Raspberry Pis at home. From my own personal experience running Raspberry Pi nodes at home for years, I&rsquo;d suggest buying a beefy UPS and connecting your modem, router, and node to it - and nothing else. Since those devices all have a pretty low power draw, you should be able to keep a node online for over an hour if not longer with a decent UPS.</p><p>If you want to try to improve your Lightning Terminal score, check out this tool that attempts to reverse engineer it: <a href=https://lnrouter.app/scores/terminal>https://lnrouter.app/scores/terminal</a></p><p>Running other services on your node can be problematic. Even though my node was overpowered (16 cores and 16 GB of RAM) I noticed that when I ran an electrum server on it and the machine load was averaging over 1.0, Lightning Terminal started reporting my node as &ldquo;unstable&rdquo;</p><p>Operating a routing node and seeking liquidity flows feels like of like deep sea fishing. You know that the fish are all around you but you can&rsquo;t actually see them. You have to keep throwing out lines and nets to infer where the flows of funds are that you can tap into.</p><blockquote class=twitter-tweet><p lang=en dir=ltr>It can be hard to tell when you lose inbound liquidity on LN. Imagine you open a nice big channel to someone who has no inbound themselves. Then you route tons of sats there, great! You have inbound from them now, but they have no inbound, so now you have no more inbound. Sorry!</p>&mdash; Alex Bosworth (@alexbosworth) <a href="https://twitter.com/alexbosworth/status/1412788505818931200?ref_src=twsrc%5Etfw">July 7, 2021</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>The max non-wumbo channel size is 16.7M sats. In my experience, trying to route payments of more than 4M sats tends to be problematic. Remember that the default max single payment value is slightly over 4M sats. Even if that payment value cap is lifted and all channels were perfectly balanced and were of the max capacity, that would make the max feasible payment 8.3M sats.</p><p>Dr. Carsten Otto has a ton of helpful notes on his web site at <a href=https://c-otto.de/>https://c-otto.de/</a></p><h2 id=going-forward>Going Forward
<a class=anchor href=#going-forward>#</a></h2><p>The tooling for lightning nodes continues to evolve; while this guide is likely out-of-date in different ways, I&rsquo;m maintaining updated lists of <a href=https://www.lopp.net/lightning-information.html#node_tools>node management tools</a> and <a href=https://www.lopp.net/lightning-information.html#liquidity>liquidity tools</a> on my web site.</p><p>There&rsquo;s still plenty of room for improvement with regard to tools that help Lightning Node operators better understand liquidity management and routing.</p><p>I&rsquo;d like to see better visualizations around channels that forward payments. <a href=https://www.thunderhub.io/>Thunderhub</a>, for example, can create chord charts to show this activity; I hope that more lightning dashboard software will start doing that automatically.</p><div class=imageWrapper><img src=/img/lln-272.png></div><p>It would be cool if you could easily send messages to the operators of your peer nodes to ask them what&rsquo;s up / determine their intentions. You can theoretically use keysend to send them a 1 satoshi payment with a message embedded, but there&rsquo;s no guarantee the node operator will ever see it. &ldquo;bos send&rdquo; will do just that.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bos send &lt;key&gt; --message<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;hey what&#39;s up?&#34;</span>
</span></span></code></pre></div><p>There&rsquo;s a bit of a bootstrapping issue with message sending. Node operators may not notice them because they aren&rsquo;t using Thunderhub or they haven&rsquo;t set up a Telegram channel for bos to send messages to, thus other node operators don&rsquo;t bother sending messages because they are likely to be missed.</p><p>Rene Pickhardt and Stefan Richter published a paper showing that finding optimal routes is vastly more complex unless the base fee is set to 0: <a href=https://arxiv.org/abs/2107.05322>https://arxiv.org/abs/2107.05322</a></p><p>I saw a ton of folks setting their node&rsquo;s base fee to 0 but I suspect this is misguided and won&rsquo;t <strong>practically</strong> improve anything at time of writing - this is a theoretical optimization for which nodes will only start reaping benefits if developers actually implement Rene and Stefan&rsquo;s path finding algorithm.</p><p>Also, the paper doesn&rsquo;t discuss other trade-offs to doing so such as the introduction of DoS vectors. Consider that when your node accepts a HTLC to route sats through it, the node must persist data related to that HTLC in its database. As such, if your base fee is 0 then someone could route millions of millisatoshi payments through your node without paying much in fees. However, in the grand scheme of potential attacks it may be trivial compared to other known issues such as <a href=https://bitcoinmagazine.com/technical/good-griefing-a-lingering-vulnerability-on-lightning-network-that-still-needs-fixing>griefing</a> and <a href=https://lists.linuxfoundation.org/pipermail/lightning-dev/2020-June/002735.html>extortion</a> that enable a malicious actor to lock up lots of funds for free.</p><p>It would also be cool if someone built a tool to visualize your node&rsquo;s inbound/outbound liquidity and all of your peer nodes&rsquo; inbound/outbound liquidity. This is somewhat difficult to know (by design) but perhaps could be roughly estimated with carefully constructed route probing. Edit: shortly after publishing this article, a <a href=https://lnrouter.app/lookups>service</a> came online to help better visualize the liquidity of other nodes on the network.</p><p>If you made it all the way to the end of this novel, congrats! Hopefully it&rsquo;s clear by now that the Lightning Network is a whole new world for us to explore and build.</p><p>Thanks to <a href=https://twitter.com/alexbosworth>Alex Bosworth</a>, <a href=https://twitter.com/ErinEMalone>Erin Malone</a>, and <a href=https://twitter.com/c_otto83>Dr. Carsten Otto</a> for reviewing and providing feedback.</p></article><hr><i>Connect to our relay to leave a comment. <a href=https://21ideas.org/en/comments/>Details</a>.<br>Подключитесь к нашему релею, чтобы оставить комментарий. <a href=https://21ideas.org/comments/>Подробнее</a>.</i>
<zap-threads anchor=https://21ideas.org/en/lightning-liquidity-management-guide/ author=npub1lm3f47nzyf0rjp6fsl4qlnkmzed4uj4h2gnf2vhe3l3mrj85vqks6z3c7l relays=wss://21ideas.nostr1.com disable=replyAnonymously legacy-url=true></zap-threads><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#your-mileage-may-vary>Your Mileage May Vary</a></li><li><a href=#a-plethora-of-variables>A Plethora of Variables</a></li><li><a href=#deciding-what-channels-to-open>Deciding What Channels to Open</a></li><li><a href=#saving-on-chain-channel-open-fees-via-batch-opens>Saving On-Chain Channel Open Fees via Batch Opens</a></li><li><a href=#opening-dual-funded-channels>Opening Dual Funded Channels</a></li><li><a href=#channel-rebalancing>Channel Rebalancing</a></li><li><a href=#channel-policy-management>Channel Policy Management</a></li><li><a href=#buying-inbound-liquidity>Buying Inbound Liquidity</a></li><li><a href=#lightning-loop>Lightning Loop</a></li><li><a href=#lightning-loops-node>Lightning Loop&rsquo;s Node</a></li><li><a href=#freeing-up-stranded-capital>Freeing up Stranded Capital</a></li></ul></li><li><a href=#results>Results</a><ul><li><a href=#other-considerations--random-thoughts>Other Considerations / Random Thoughts</a></li></ul></li><li><a href=#going-forward>Going Forward</a></li></ul></li></ul></nav></div></aside></main><script>"use strict";const METRICS={FEE:"fee",BLOCK:"block",PRICE:"price",SATS:"sats",BTC:"btc"};let currentMetric=METRICS.FEE,lastKnownValues={fee:{label:"Комиссия",value:"0 sat/vB"},block:{label:"Высота блока",value:"0"},price:{label:"Цена",value:"$0"},sats:{label:"Московское время",value:"00:00"},btc:{label:"",value:"1 BTC = 1 BTC"}};function formatSatsAsTime(e){const t=Math.round(e).toString().padStart(4,"0"),n=t.slice(0,-2),s=t.slice(-2);return`${n}:${s}`}function formatNumber(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}function updateDisplay(){const n=document.getElementById("metrics-label"),e=document.getElementById("metrics-value");if(!n||!e)return;const t=lastKnownValues[currentMetric];n.textContent=t.label,e.textContent=t.value,e.style.paddingTop=t.label?"0":"0.7rem"}async function updateMetrics(){try{const[t,n,e]=await Promise.all([fetch("https://mempool.space/api/v1/fees/recommended").then(e=>e.json()),fetch("https://mempool.space/api/blocks/tip/height").then(e=>e.json()),fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd").then(e=>e.json())]);lastKnownValues.fee.value=`${t.fastestFee} sat/vB`,lastKnownValues.block.value=formatNumber(n),lastKnownValues.price.value=`$${formatNumber(e.bitcoin.usd)}`;const s=Math.round(1e8/e.bitcoin.usd);lastKnownValues.sats.value=formatSatsAsTime(s),updateDisplay()}catch(e){console.error("Error fetching metrics:",e)}}function cycleMetric(){const e=Object.values(METRICS),t=e.indexOf(currentMetric);currentMetric=e[(t+1)%e.length],updateDisplay()}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("metrics-container");e&&(e.addEventListener("click",cycleMetric),updateMetrics(),setInterval(updateMetrics,6e4))})</script></body></html>