---
title: "Размер транзакции"
h1: "Размер транзакции: Байты, единицы веса и виртуальные байты"
cover: /img/txsize/01.jpg
description: "Единицы веса и виртуальные байты – это единицы измерения, уникальные для Биткоина. Они также определяют размер транзакции в байтах, но дают скидку на некоторые части данных транзакции и используются при расчете того, сколько транзакций может поместиться в блок."
url: transaction-size
date: 2023-11-03
bookFlatSection: false
weight: 71
---

{{< hint btc>}}
Перевод статьи [Грега Уокера](https://twitter.com/in3rsha), [опубликованной](https://learnmeabitcoin.com/technical/transaction/size) на сайте learnmeabitcoin.

[Поддержать проект](/contribute/).
{{</hint >}}

Размер транзакции Биткоина можно измерить тремя способами:

1. **Байты (b)** – размер транзакции на диске.
2. **Единицы веса (Weight Units – wu)** – для размещения транзакций в блоке.
3. **Виртуальные байты (vB)** – для сравнения размера комиссии в различных транзакциях.

*Байт* – самая простая единица измерения. Она используется для измерения любого объема данных на компьютере.

_Единицы веса_ и _виртуальные байты_ – это единицы измерения, уникальные для Биткоина. Они также определяют размер транзакции в байтах, но дают **скидку на некоторые части данных транзакции** и используются при расчете того, сколько транзакций может поместиться в блок.

## 1. Байты (b)

{{% image "/img/txsize/02-ru.png" /%}}

Это очевидный способ измерения размера транзакции. Это просто _фактический_ размер транзакции с точки зрения того, сколько байт пространства она занимает.

Байты используются для измерения размера транзакции при ее передаче по сети или места, которое она занимает на диске (например, при хранении в файлах блокчейна).

{{% hint info %}}
Измерение размера транзакции в байтах было более важным, когда ограничение на размер блока также измерялось в байтах (1 000 000 байт, или 1 мегабайт). Однако теперь ограничение размера блока основывается на _единицах веса_.
{{% /hint %}}

### Пример

Транзакция: [30dcd74b7fd8a585db3b2beddd4a7fc0edcfe9b8a1bac9abee695648659f8a6a](https://learnmeabitcoin.com/explorer/tx/30dcd74b7fd8a585db3b2beddd4a7fc0edcfe9b8a1bac9abee695648659f8a6a)

01000000000101dd40a8d7f105055e781afa632207f5d3c4b4f4cad9f0fb320d0f0aa8e1ba904b0000000000ffffffff021027000000000000160014858e1f88ff6f383f45a75088e15a095f20fc663f841c0000000000001976a9142241a6c3d4cc3367efaa88b58d24748caef79a7288ac02483045022100d66341c3e6ce846b92bedcf9bc673ab8e47b770c616618eb91009e44816f4c2f0220622b5ebf6afabee3f4255bbcb84609e1185d4b6b1055602f5eed2541e26324620121022ed6c7d33a59cc16d37ad9ba54230696bd5424b8931c2a68ce76b0dbbc222f6500000000

Размер: 226 байт

В этой транзакции содержится 226 байт.

Вы можете проверить это самостоятельно, поскольку каждые 2 шестнадцатеричных символа представляют собой 1 байт.

### Типичные размеры транзакций

Размер транзакции в _байтах_ в основном **зависит от количества [входов и выходов](/protocol/utxo)**. Вот средние размеры для типичных транзакций (со стандартными скриптами блокировки [P2PKH](/sravnenie-tipov-bitcoin-adresov) на выходах):

- Входы: 1, Выходы: 1 = 191 или 192 байт
- Входы: 1, Выходы: 2 = 225 или 226 байт _(чаще всего)_
- Входы: 2, Выходы: 1 = 338 или 339 байт
- Входы: 2, Выходы: 2 = 373 или 374 байт _(чаще всего)_

Чем больше входов и выходов в транзакции, тем больше ее размер.

Нет никаких ограничений на размер транзакции в байтах, кроме того, что она должна помещаться в блок.

## 2. Единицы веса (Weight Units – wu)

{{% image "/img/txsize/03-ru.png" /%}}

Каждая транзакция характеризуется _весом_. Это измерение было введено в обновлении [Segregated Witness](/segwit). Вес транзакции вычисляется путем умножения размера (в байтах) различных частей транзакции на 4 или 1:

|Поле|Множитель|
|---|---|
|версия|x4|
|маркер|x1|
|флаг|x1|
|вход|x4|
|выход|x4|
|witness-данные|x1|
|время блокировки|x4|

Таким образом, это дает _скидку_ на [witness-данные](https://learnmeabitcoin.com/technical/transaction/witness/).

### Пример

Транзакция: [30dcd74b7fd8a585db3b2beddd4a7fc0edcfe9b8a1bac9abee695648659f8a6a](https://learnmeabitcoin.com/explorer/tx/30dcd74b7fd8a585db3b2beddd4a7fc0edcfe9b8a1bac9abee695648659f8a6a)

01000000<mark>0001</mark>01dd40a8d7f105055e781afa632207f5d3c4b4f4cad9f0fb320d0f0aa8e1ba904b0000000000ffffffff021027000000000000160014858e1f88ff6f383f45a75088e15a095f20fc663f841c0000000000001976a9142241a6c3d4cc3367efaa88b58d24748caef79a7288ac<mark>02483045022100d66341c3e6ce846b92bedcf9bc673ab8e47b770c616618eb91009e44816f4c2f0220622b5ebf6afabee3f4255bbcb84609e1185d4b6b1055602f5eed2541e26324620121022ed6c7d33a59cc16d37ad9ba54230696bd5424b8931c2a68ce76b0dbbc222f65</mark>00000000

Размер: 226 байт

Вес: 574 единиц веса (116 x 4 + <mark>110 x 1</mark>)

В этой транзакции 226 байт. Из них 116 байт – это не-witness данные, поэтому они умножаются на 4, а 110 байт – это <mark>witness-данные</mark>, поэтому они умножаются на 1. Сложив их вместе, вы получите 574 единицы веса.

### Ограничение веса блока (4 000 000 единиц веса)

Измерение веса важно потому, что **блоки могут содержать до 4 000 000 единиц веса** данных транзакций.

Поэтому, когда майнеры заполняют свои блоки-кандидаты транзакциями, они используют вес транзакций, чтобы определить, сколько транзакций они могут вместить в свой блок.

{{% image "/img/txsize/04-ru.png" /%}}

{{% hint info %}}
Использование байтов для определения размера транзакций и ограничения размера блока было более простым. Но измерение веса привносит _справедливость_ в стоимость траты UTXO.
{{% /hint %}}

### Почему witness-данные весят меньше?

Потому что это помогает установить баланс между стоимостью создания UTXO и стоимостью его расходования (с точки зрения комиссии за транзакции).

Объем данных, необходимых для разблокировки входа (т. е. данные подписи), несправедливо больше, чем объем данных, необходимых для блокировки выхода. Поэтому измерение веса приводит "размер" входов и выходов в транзакции в большее соответствие друг с другом.

{{% image "/img/txsize/05-ru.png" /%}}

## 3. Виртуальные байты (vByte, vB)

{{% image "/img/txsize/06-ru.png" /%}}

_Виртуальный размер_ транзакции равен ее _весу_, деленному на 4.

Или, говоря иначе, вместо того чтобы умножать некоторые части транзакции на 4 для создания скидки на witness-данные, вы делаете скидку непосредственно на witness-данные, умножая их на 0,25:

|Поле|Множитель|
|---|---|
|версия|x1|
|маркер|x0.25|
|флаг|x0.25|
|вход|x1|
|выход|x1|
|witness-данные|x0.25|
|время блокировки|x1|

Таким образом, "вес" и "виртуальный размер" обеспечивают одно и то же измерение, просто в разных единицах. Но использование виртуальных байтов облегчает сравнение ставки комиссии segwit-транзакций со ставкой комиссии старых транзакций (в которых ранее использовались _саты за байт_ – *sat/byte*).

{{% hint info %}}
Legacy-транзакция будет иметь тот же размер в _байтах_, что и в _виртуальных байтах_.
{{% /hint %}}

{{% hint info %}}
Блок может содержать 1 000 000 виртуальных байт.
{{% /hint %}}

### Пример

Транзакция: [30dcd74b7fd8a585db3b2beddd4a7fc0edcfe9b8a1bac9abee695648659f8a6a](https://learnmeabitcoin.com/explorer/tx/30dcd74b7fd8a585db3b2beddd4a7fc0edcfe9b8a1bac9abee695648659f8a6a)

01000000<mark>0001</mark>01dd40a8d7f105055e781afa632207f5d3c4b4f4cad9f0fb320d0f0aa8e1ba904b0000000000ffffffff021027000000000000160014858e1f88ff6f383f45a75088e15a095f20fc663f841c0000000000001976a9142241a6c3d4cc3367efaa88b58d24748caef79a7288ac<mark>02483045022100d66341c3e6ce846b92bedcf9bc673ab8e47b770c616618eb91009e44816f4c2f0220622b5ebf6afabee3f4255bbcb84609e1185d4b6b1055602f5eed2541e26324620121022ed6c7d33a59cc16d37ad9ba54230696bd5424b8931c2a68ce76b0dbbc222f65</mark>00000000

Размер: 226 байт

Виртуальный размер: 143.50 виртуальных байта (116 x 1 + <mark>110 x 0.25</mark>)

В этой транзакции 226 байт. Из них 116 байт – это не-witness данные, поэтому они умножаются на 1, а 110 байт – это <mark>witness-данные</mark>, поэтому они умножаются на 0.25. Сложив их вместе, вы получите 143.50 виртуальных байта.

Как видите, расчеты веса и виртуального размера работают одинаково.

### Почему мы используем vByte?

Так зачем же нужны и вес, и vByte? Почему бы не вычислить вес транзакции, умножив некоторые части на 0.25?

Другими словами, зачем иметь две единицы измерения, которые делают одно и то же?

> Потому что виртуальный размер является дробным при точном вычислении. Вес является целым числом. В коде консенсуса мы используем только целые числа.
> 
> – *Питер Вюлле, [bitcoin.stackexchange.com](https://bitcoin.stackexchange.com/questions/53623/why-does-bip141-define-both-virtual-transaction-size-and-weight)*

Работа с дробными числами на компьютерах часто приводит к [ошибкам округления](https://floating-point-gui.de/errors/rounding/), поэтому в биткойне мы предпочитаем работать с целыми числами при выполнении критически важных вычислений. **Целочисленная арифметика всегда возвращает неизменные и достоверные результаты, в то время как арифметика с плавающей точкой – нет.**

Итак, подведем итоги:

- **Единицы веса** — Используется _внутри кода_ при определении того, сколько транзакций может поместиться в блок.
- **Виртуальные байты** — Используется _людьми_ при сравнении различных ставок комиссии за транзакции.

## Источники

- [BIP 141 (Расчет размера транзакций)](https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki#transaction-size-calculations)
- [Есть ли разница между байтами и виртуальными байтами (vByte)?](https://bitcoin.stackexchange.com/questions/89385/is-there-a-difference-between-bytes-and-virtual-bytes-vbytes)
- Спасибо [Люку Дашеру](https://github.com/luke-jr) за то, что объяснил мне в IRC, как умножение не-witness данных на 4 помогает создать баланс между затратами на создание и расходование UTXO.

### Поддержите переводчика

Поддержать переводчика можно, отправив немного сат в сети Лайтнинг:

{{% image "/img/btclinux-ln-qr.jpg" %}}
_LNURL1DP68GURN8GHJ7MRW9E6XJURN9UH8WETVDSKKKMN0WAHZ7MRWW4EXCUP0X9UX2VENXDJN2CTRXSUN2VE3XGCRQPNAPC6_
{{% /image %}}